/*!
 * w-puppeteer-uitest: getB64 v1.0.9
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("bluebird"),require("puppeteer"),require("fs")):"function"==typeof define&&define.amd?define(["bluebird","puppeteer","fs"],b):(a=a||self,a["w-puppeteer-uitest"]=b(a.bluebird,a.puppeteer,a.fs))})(this,function(a,c,d){'use strict';function e(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":V&&V in Object(a)?R(a):U(a)}function f(a,b){if(F(a))return!1;var c=typeof a;return!!("number"==c||"symbol"==c||"boolean"==c||null==a||Y(a))||$.test(a)||!Z.test(a)||null!=b&&a in Object(b)}function g(a){return!!da&&da in a}function h(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function i(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function j(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function k(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new TypeError("Expected a function");var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(k.Cache||Fa),c}function l(a){if("string"==typeof a)return a;if(F(a))return Ja(a,l)+"";if(Y(a))return Ma?Ma.call(a):"";var b=a+"";return"0"==b&&1/a==-Ka?"-0":b}function m(a){let b=Object.prototype.toString.call(a);return"[object String]"===b}function n(a){return!!(m(a)&&""!==a)}function o(a){let b=Object.prototype.toString.call(a);return"[object Number]"===b}function p(a){let c=!1;return n(a)?c=!isNaN(+a):o(a)&&(c=!0),c}function q(a){if(!p(a))return 0;let b=$a(a);return b}function r(a){return!!p(a)&&(a=q(a),ab(a))}function s(a){let b=Object.prototype.toString.call(a);return"[object Object]"===b}function t(a){let b=Object.prototype.toString.call(a);return"[object Array]"===b}function u(a){return bb(a)}function w(a){let b=Object.prototype.toString.call(a);return"[object Undefined]"===b}function x(a){let b=Object.prototype.toString.call(a);return"[object Null]"===b}function y(a){if(s(a)){for(let b in a)return!1;return!0}return!1}function z(a){return!!(m(a)&&""===a)}function A(a){return!!t(a)&&0===a.length}function B(a){return!!w(a)||!!x(a)||!!y(a)||!!z(a)||!!A(a)}function C(a){if(!p(a))return 0;a=q(a);let b=eb(a);return"0"===b+""?0:b}async function D(b,e={}){async function f(a,b=0){b=C(b);let c;if(0===b)c=await m.$(a),B(c)&&console.log("page.$ get no result: "+a);else{let d=await m.$$(a);0===d.length&&console.log("page.$$ get no result: "+a),c=d[b]}c.boundingBox||console.log("ele.boundingBox get no result: "+a);let d=await c.boundingBox();return d.cx=d.x+d.width/2,d.cy=d.y+d.height/2,d.ele=c,d}let g=Ra(e,"headless");u(g)||(g=d.truncate);let h=Ra(e,"viewport");s(h)||(h={x:0,y:0,width:800,height:600});let i=Ra(e,"actions");t(i)||(i=[]);let j=Ra(e,"waitsec");r(j)||(j=5);let k={headless:g,slowMo:20},l=await c.launch(k),m=await l.newPage();await m.goto(b),await m.setViewport(h),await m.waitFor(1e3*j),await a.mapSeries(i,async function(a){var b=String.fromCharCode;if("wait"===a.mode)await m.waitFor(a.time);else if("resize"===a.mode)await m.waitFor(300),await m.setViewport({x:0,y:0,width:a.width,height:a.height}),await m.waitFor(300);else if("move"===a.mode)await m.waitFor(300),await m.mouse.move(a.x1,a.y1),await m.waitFor(300);else if("elemove"===a.mode){await m.waitFor(300);let b=await f(a.selector,a.nth);await m.mouse.move(b.cx,b.cy),await m.waitFor(300)}else if("elehover"===a.mode)await m.waitFor(300),await m.hover(a.selector),await m.waitFor(300);else if("drag"===a.mode)await m.waitFor(300),await m.mouse.move(a.x1,a.y1),await m.mouse.down(),await m.waitFor(300),await m.mouse.move(a.x2,a.y2,{steps:50}),await m.waitFor(300),await m.mouse.up(),await m.waitFor(300);else if("eledrag"===a.mode){await m.waitFor(300);let b=await f(a.selector,a.nth);await m.mouse.move(b.cx,b.cy),await m.mouse.down(),await m.waitFor(300),await m.mouse.move(b.cx+a.shiftx,b.cy+a.shifty,{steps:50}),await m.waitFor(300),await m.mouse.up(),await m.waitFor(300)}else if("click"===a.mode)await m.waitFor(300),await m.mouse.move(a.x1,a.y1),await m.mouse.down(),await m.mouse.up(),await m.waitFor(300);else if("eleclick"===a.mode){await m.waitFor(300);let b=await f(a.selector,a.nth);await b.ele.click(),await m.waitFor(300)}else if("dbclick"===a.mode)await m.waitFor(300),await m.mouse.click(a.x1,a.y1,{clickCount:2}),await m.waitFor(300);else if("eledbclick"===a.mode){await m.waitFor(300);let b=await f(a.selector,a.nth);await b.ele.click({clickCount:2}),await m.waitFor(300)}else if("type"===a.mode)await m.waitFor(300),await m.keyboard.type(a.str,{delay:50}),await m.keyboard.type(b(13)),await m.waitFor(300);else if("eletype"===a.mode){await m.waitFor(300);let c=await f(a.selector,a.nth);await c.ele.click(),await m.waitFor(50),await m.keyboard.type(a.str,{delay:50}),a.noEnter||(await m.keyboard.type(b(13))),await m.waitFor(300)}else if("keypress"===a.mode)await m.waitFor(300),await m.keyboard.press(a.key),await m.waitFor(300);else if("elefocus"===a.mode){await m.waitFor(300);let b=await f(a.selector,a.nth);await b.ele.focus(),await m.waitFor(300)}else console.log("mode is unrecognized: "+a.mode)}),await m.waitFor(2e3);let n=await m.screenshot({encoding:"base64"});return await m.close(),await l.close(),n}a=a&&a.hasOwnProperty("default")?a["default"]:a,c=c&&c.hasOwnProperty("default")?c["default"]:c;var E=Array.isArray,F=E,G="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,H="object"==typeof G&&G&&G.Object===Object&&G,I="object"==typeof self&&self&&self.Object===Object&&self,J=H||I||Function("return this")(),K=J,L=K.Symbol,M=L,N=Object.prototype,O=N.hasOwnProperty,P=N.toString,Q=M?M.toStringTag:void 0,R=function(a){var b=O.call(a,Q),c=a[Q];try{a[Q]=void 0;var d=!0}catch(a){}var e=P.call(a);return d&&(b?a[Q]=c:delete a[Q]),e},S=Object.prototype,T=S.toString,U=function(a){return T.call(a)},V=M?M.toStringTag:void 0,W=e,X=function(a){return null!=a&&"object"==typeof a},Y=function(a){return"symbol"==typeof a||X(a)&&W(a)=="[object Symbol]"},Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/,_=function(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)},aa=function(a){if(!_(a))return!1;var b=W(a);return b=="[object Function]"||b=="[object GeneratorFunction]"||b=="[object AsyncFunction]"||b=="[object Proxy]"},ba=K["__core-js_shared__"],ca=ba,da=function(){var a=/[^.]+$/.exec(ca&&ca.keys&&ca.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),ea=Function.prototype,fa=ea.toString,ga=function(a){if(null!=a){try{return fa.call(a)}catch(a){}try{return a+""}catch(a){}}return""},ha=/[\\^$.*+?()[\]{}|]/g,ia=/^\[object .+?Constructor\]$/,ja=Function.prototype,ka=Object.prototype,la=ja.toString,ma=ka.hasOwnProperty,na=RegExp("^"+la.call(ma).replace(ha,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oa=function(a){if(!_(a)||g(a))return!1;var b=aa(a)?na:ia;return b.test(ga(a))},pa=function(a,b){return null==a?void 0:a[b]},qa=function(a,b){var c=pa(a,b);return oa(c)?c:void 0},ra=qa(Object,"create"),sa=ra,ta=Object.prototype,ua=ta.hasOwnProperty,va=Object.prototype,wa=va.hasOwnProperty;h.prototype.clear=function(){this.__data__=sa?sa(null):{},this.size=0},h.prototype["delete"]=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b},h.prototype.get=function(a){var b=this.__data__;if(sa){var c=b[a];return c==="__lodash_hash_undefined__"?void 0:c}return ua.call(b,a)?b[a]:void 0},h.prototype.has=function(a){var b=this.__data__;return sa?b[a]!==void 0:wa.call(b,a)},h.prototype.set=function(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=sa&&void 0===b?"__lodash_hash_undefined__":b,this};var xa=h,ya=function(a,b){return a===b||a!==a&&b!==b},za=function(a,b){for(var c=a.length;c--;)if(ya(a[c][0],b))return c;return-1},Aa=Array.prototype,Ba=Aa.splice;i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype["delete"]=function(a){var b=this.__data__,c=za(b,a);if(0>c)return!1;var d=b.length-1;return c==d?b.pop():Ba.call(b,c,1),--this.size,!0},i.prototype.get=function(a){var b=this.__data__,c=za(b,a);return 0>c?void 0:b[c][1]},i.prototype.has=function(a){return-1<za(this.__data__,a)},i.prototype.set=function(a,b){var c=this.__data__,d=za(c,a);return 0>d?(++this.size,c.push([a,b])):c[d][1]=b,this};var Ca=qa(K,"Map"),Da=function(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a},Ea=function(a,b){var c=a.__data__;return Da(b)?c["string"==typeof b?"string":"hash"]:c.map};j.prototype.clear=function(){this.size=0,this.__data__={hash:new xa,map:new(Ca||i),string:new xa}},j.prototype["delete"]=function(a){var b=Ea(this,a)["delete"](a);return this.size-=b?1:0,b},j.prototype.get=function(a){return Ea(this,a).get(a)},j.prototype.has=function(a){return Ea(this,a).has(a)},j.prototype.set=function(a,b){var c=Ea(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this};var Fa=j;k.Cache=Fa;var Ga=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ha=/\\(\\)?/g,Ia=function(a){var b=k(a,function(a){return 500===c.size&&c.clear(),a}),c=b.cache;return b}(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(Ga,function(a,c,d,e){b.push(d?e.replace(Ha,"$1"):c||a)}),b}),Ja=function(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e},Ka=1/0,La=M?M.prototype:void 0,Ma=La?La.toString:void 0,Na=function(a){return null==a?"":l(a)},Oa=function(a,b){return F(a)?a:f(a,b)?[a]:Ia(Na(a))},Pa=function(a){if("string"==typeof a||Y(a))return a;var b=a+"";return"0"==b&&1/a==-(1/0)?"-0":b},Qa=function(a,b){b=Oa(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[Pa(b[c++])];return c&&c==d?a:void 0},Ra=function(a,b,c){var d=null==a?void 0:Qa(a,b);return d===void 0?c:d},Sa=0/0,Ta=/^\s+|\s+$/g,Ua=/^[-+]0x[0-9a-f]+$/i,Va=/^0b[01]+$/i,Wa=/^0o[0-7]+$/i,Xa=parseInt,Ya=function(a){if("number"==typeof a)return a;if(Y(a))return Sa;if(_(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=_(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(Ta,"");var c=Va.test(a);return c||Wa.test(a)?Xa(a.slice(2),c?2:8):Ua.test(a)?Sa:+a},Za=1/0,$a=function(a){if(!a)return 0===a?a:0;if(a=Ya(a),a===Za||a===-Za){var b=0>a?-1:1;return 1.7976931348623157e+308*b}return a===a?a:0},_a=function(a){var b=$a(a),c=b%1;return b===b?c?b-c:b:0},ab=function(a){return"number"==typeof a&&a==_a(a)},bb=function(a){return!0===a||!1===a||X(a)&&W(a)=="[object Boolean]"},cb=Math.min,db=function(a){var b=Math[a];return function(a,c){if(a=Ya(a),c=null==c?0:cb(_a(c),292),c){var d=(Na(a)+"e").split("e"),e=b(d[0]+"e"+(+d[1]+c));return d=(Na(e)+"e").split("e"),+(d[0]+"e"+(+d[1]-c))}return b(a)}}("round"),eb=db;return D});
//# sourceMappingURL=w-puppeteer-uitest-getB64.umd.js.map
