/*!
 * w-puppeteer-uitest: getB64 v1.0.8
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("bluebird"),require("puppeteer")):"function"==typeof define&&define.amd?define(["bluebird","puppeteer"],b):(a=a||self,a["w-puppeteer-uitest"]=b(a.bluebird,a.puppeteer))})(this,function(a,c){'use strict';function d(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":U&&U in Object(a)?Q(a):T(a)}function e(a,b){if(E(a))return!1;var c=typeof a;return!!("number"==c||"symbol"==c||"boolean"==c||null==a||X(a))||Z.test(a)||!Y.test(a)||null!=b&&a in Object(b)}function f(a){return!!ca&&ca in a}function g(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function h(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function i(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function j(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new TypeError("Expected a function");var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(j.Cache||Ea),c}function k(a){if("string"==typeof a)return a;if(E(a))return Ia(a,k)+"";if(X(a))return La?La.call(a):"";var b=a+"";return"0"==b&&1/a==-Ja?"-0":b}function l(a){let b=Object.prototype.toString.call(a);return"[object String]"===b}function m(a){return!!(l(a)&&""!==a)}function n(a){let b=Object.prototype.toString.call(a);return"[object Number]"===b}function o(a){let c=!1;return m(a)?c=!isNaN(+a):n(a)&&(c=!0),c}function p(a){if(!o(a))return 0;let b=Za(a);return b}function q(a){return!!o(a)&&(a=p(a),_a(a))}function r(a){let b=Object.prototype.toString.call(a);return"[object Object]"===b}function s(a){let b=Object.prototype.toString.call(a);return"[object Array]"===b}function t(a){return ab(a)}function u(a){let b=Object.prototype.toString.call(a);return"[object Undefined]"===b}function w(a){let b=Object.prototype.toString.call(a);return"[object Null]"===b}function x(a){if(r(a)){for(let b in a)return!1;return!0}return!1}function y(a){return!!(l(a)&&""===a)}function z(a){return!!s(a)&&0===a.length}function A(a){return!!u(a)||!!w(a)||!!x(a)||!!y(a)||!!z(a)}function B(a){if(!o(a))return 0;a=p(a);let b=db(a);return"0"===b+""?0:b}async function C(b,d={}){async function e(a,b=0){b=B(b);let c;if(0===b)c=await l.$(a),A(c)&&console.log("page.$ get no result: "+a);else{let d=await l.$$(a);0===d.length&&console.log("page.$$ get no result: "+a),c=d[b]}c.boundingBox||console.log("ele.boundingBox get no result: "+a);let d=await c.boundingBox();return d.cx=d.x+d.width/2,d.cy=d.y+d.height/2,d.ele=c,d}let f=Qa(d,"headless");t(f)||(f=!0);let g=Qa(d,"viewport");r(g)||(g={x:0,y:0,width:800,height:600});let h=Qa(d,"actions");s(h)||(h=[]);let i=Qa(d,"waitsec");q(i)||(i=5);let j={headless:f,slowMo:20},k=await c.launch(j),l=await k.newPage();await l.goto(b),await l.setViewport(g),await l.waitFor(1e3*i),await a.mapSeries(h,async function(a){var b=String.fromCharCode;if("wait"===a.mode)await l.waitFor(a.time);else if("resize"===a.mode)await l.waitFor(300),await l.setViewport({x:0,y:0,width:a.width,height:a.height}),await l.waitFor(300);else if("move"===a.mode)await l.waitFor(300),await l.mouse.move(a.x1,a.y1),await l.waitFor(300);else if("elemove"===a.mode){await l.waitFor(300);let b=await e(a.selector,a.nth);await l.mouse.move(b.cx,b.cy),await l.waitFor(300)}else if("elehover"===a.mode)await l.waitFor(300),await l.hover(a.selector),await l.waitFor(300);else if("drag"===a.mode)await l.waitFor(300),await l.mouse.move(a.x1,a.y1),await l.mouse.down(),await l.waitFor(300),await l.mouse.move(a.x2,a.y2,{steps:50}),await l.waitFor(300),await l.mouse.up(),await l.waitFor(300);else if("eledrag"===a.mode){await l.waitFor(300);let b=await e(a.selector,a.nth);await l.mouse.move(b.cx,b.cy),await l.mouse.down(),await l.waitFor(300),await l.mouse.move(b.cx+a.shiftx,b.cy+a.shifty,{steps:50}),await l.waitFor(300),await l.mouse.up(),await l.waitFor(300)}else if("click"===a.mode)await l.waitFor(300),await l.mouse.move(a.x1,a.y1),await l.mouse.down(),await l.mouse.up(),await l.waitFor(300);else if("eleclick"===a.mode){await l.waitFor(300);let b=await e(a.selector,a.nth);await b.ele.click(),await l.waitFor(300)}else if("dbclick"===a.mode)await l.waitFor(300),await l.mouse.click(a.x1,a.y1,{clickCount:2}),await l.waitFor(300);else if("eledbclick"===a.mode){await l.waitFor(300);let b=await e(a.selector,a.nth);await b.ele.click({clickCount:2}),await l.waitFor(300)}else if("type"===a.mode)await l.waitFor(300),await l.keyboard.type(a.str,{delay:50}),await l.keyboard.type(b(13)),await l.waitFor(300);else if("eletype"===a.mode){await l.waitFor(300);let c=await e(a.selector,a.nth);await c.ele.click(),await l.waitFor(50),await l.keyboard.type(a.str,{delay:50}),a.noEnter||(await l.keyboard.type(b(13))),await l.waitFor(300)}else if("keypress"===a.mode)await l.waitFor(300),await l.keyboard.press(a.key),await l.waitFor(300);else if("elefocus"===a.mode){await l.waitFor(300);let b=await e(a.selector,a.nth);await b.ele.focus(),await l.waitFor(300)}else console.log("mode is unrecognized: "+a.mode)}),await l.waitFor(2e3);let m=await l.screenshot({encoding:"base64"});return await l.close(),await k.close(),m}a=a&&a.hasOwnProperty("default")?a["default"]:a,c=c&&c.hasOwnProperty("default")?c["default"]:c;var D=Array.isArray,E=D,F="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,G="object"==typeof F&&F&&F.Object===Object&&F,H="object"==typeof self&&self&&self.Object===Object&&self,I=G||H||Function("return this")(),J=I,K=J.Symbol,L=K,M=Object.prototype,N=M.hasOwnProperty,O=M.toString,P=L?L.toStringTag:void 0,Q=function(a){var b=N.call(a,P),c=a[P];try{a[P]=void 0;var d=!0}catch(a){}var e=O.call(a);return d&&(b?a[P]=c:delete a[P]),e},R=Object.prototype,S=R.toString,T=function(a){return S.call(a)},U=L?L.toStringTag:void 0,V=d,W=function(a){return null!=a&&"object"==typeof a},X=function(a){return"symbol"==typeof a||W(a)&&V(a)=="[object Symbol]"},Y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Z=/^\w*$/,$=function(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)},_=function(a){if(!$(a))return!1;var b=V(a);return b=="[object Function]"||b=="[object GeneratorFunction]"||b=="[object AsyncFunction]"||b=="[object Proxy]"},aa=J["__core-js_shared__"],ba=aa,ca=function(){var a=/[^.]+$/.exec(ba&&ba.keys&&ba.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),da=Function.prototype,ea=da.toString,fa=function(a){if(null!=a){try{return ea.call(a)}catch(a){}try{return a+""}catch(a){}}return""},ga=/[\\^$.*+?()[\]{}|]/g,ha=/^\[object .+?Constructor\]$/,ia=Function.prototype,ja=Object.prototype,ka=ia.toString,la=ja.hasOwnProperty,ma=RegExp("^"+ka.call(la).replace(ga,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),na=function(a){if(!$(a)||f(a))return!1;var b=_(a)?ma:ha;return b.test(fa(a))},oa=function(a,b){return null==a?void 0:a[b]},pa=function(a,b){var c=oa(a,b);return na(c)?c:void 0},qa=pa(Object,"create"),ra=qa,sa=Object.prototype,ta=sa.hasOwnProperty,ua=Object.prototype,va=ua.hasOwnProperty;g.prototype.clear=function(){this.__data__=ra?ra(null):{},this.size=0},g.prototype["delete"]=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b},g.prototype.get=function(a){var b=this.__data__;if(ra){var c=b[a];return c==="__lodash_hash_undefined__"?void 0:c}return ta.call(b,a)?b[a]:void 0},g.prototype.has=function(a){var b=this.__data__;return ra?b[a]!==void 0:va.call(b,a)},g.prototype.set=function(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=ra&&void 0===b?"__lodash_hash_undefined__":b,this};var wa=g,xa=function(a,b){return a===b||a!==a&&b!==b},ya=function(a,b){for(var c=a.length;c--;)if(xa(a[c][0],b))return c;return-1},za=Array.prototype,Aa=za.splice;h.prototype.clear=function(){this.__data__=[],this.size=0},h.prototype["delete"]=function(a){var b=this.__data__,c=ya(b,a);if(0>c)return!1;var d=b.length-1;return c==d?b.pop():Aa.call(b,c,1),--this.size,!0},h.prototype.get=function(a){var b=this.__data__,c=ya(b,a);return 0>c?void 0:b[c][1]},h.prototype.has=function(a){return-1<ya(this.__data__,a)},h.prototype.set=function(a,b){var c=this.__data__,d=ya(c,a);return 0>d?(++this.size,c.push([a,b])):c[d][1]=b,this};var Ba=pa(J,"Map"),Ca=function(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a},Da=function(a,b){var c=a.__data__;return Ca(b)?c["string"==typeof b?"string":"hash"]:c.map};i.prototype.clear=function(){this.size=0,this.__data__={hash:new wa,map:new(Ba||h),string:new wa}},i.prototype["delete"]=function(a){var b=Da(this,a)["delete"](a);return this.size-=b?1:0,b},i.prototype.get=function(a){return Da(this,a).get(a)},i.prototype.has=function(a){return Da(this,a).has(a)},i.prototype.set=function(a,b){var c=Da(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this};var Ea=i;j.Cache=Ea;var Fa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ga=/\\(\\)?/g,Ha=function(a){var b=j(a,function(a){return 500===c.size&&c.clear(),a}),c=b.cache;return b}(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(Fa,function(a,c,d,e){b.push(d?e.replace(Ga,"$1"):c||a)}),b}),Ia=function(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e},Ja=1/0,Ka=L?L.prototype:void 0,La=Ka?Ka.toString:void 0,Ma=function(a){return null==a?"":k(a)},Na=function(a,b){return E(a)?a:e(a,b)?[a]:Ha(Ma(a))},Oa=function(a){if("string"==typeof a||X(a))return a;var b=a+"";return"0"==b&&1/a==-(1/0)?"-0":b},Pa=function(a,b){b=Na(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[Oa(b[c++])];return c&&c==d?a:void 0},Qa=function(a,b,c){var d=null==a?void 0:Pa(a,b);return d===void 0?c:d},Ra=0/0,Sa=/^\s+|\s+$/g,Ta=/^[-+]0x[0-9a-f]+$/i,Ua=/^0b[01]+$/i,Va=/^0o[0-7]+$/i,Wa=parseInt,Xa=function(a){if("number"==typeof a)return a;if(X(a))return Ra;if($(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=$(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(Sa,"");var c=Ua.test(a);return c||Va.test(a)?Wa(a.slice(2),c?2:8):Ta.test(a)?Ra:+a},Ya=1/0,Za=function(a){if(!a)return 0===a?a:0;if(a=Xa(a),a===Ya||a===-Ya){var b=0>a?-1:1;return 1.7976931348623157e+308*b}return a===a?a:0},$a=function(a){var b=Za(a),c=b%1;return b===b?c?b-c:b:0},_a=function(a){return"number"==typeof a&&a==$a(a)},ab=function(a){return!0===a||!1===a||W(a)&&V(a)=="[object Boolean]"},bb=Math.min,cb=function(a){var b=Math[a];return function(a,c){if(a=Xa(a),c=null==c?0:bb($a(c),292),c){var d=(Ma(a)+"e").split("e"),e=b(d[0]+"e"+(+d[1]+c));return d=(Ma(e)+"e").split("e"),+(d[0]+"e"+(+d[1]-c))}return b(a)}}("round"),db=cb;return C});
//# sourceMappingURL=w-puppeteer-uitest-getB64.umd.js.map
