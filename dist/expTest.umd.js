/*!
 * expTest v1.0.29
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("bluebird"),require("fs"),require("puppeteer"),require("jimp")):"function"==typeof define&&define.amd?define(["bluebird","fs","puppeteer","jimp"],t):(e=e||self).expTest=t(e.bluebird,e.fs,e.puppeteer,e.jimp)}(this,(function(e,t,r,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var i=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(e,t,r,n){var a=t&&t.prototype instanceof y?t:y,o=Object.create(a.prototype),i=new E(n||[]);return o._invoke=function(e,t,r){var n=l;return function(a,o){if(n===h)throw new Error("Generator is already running");if(n===v){if("throw"===a)throw o;return P()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=F(i,r);if(c){if(c===w)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var u=f(e,t,r);if("normal"===u.type){if(n=r.done?v:p,u.arg===w)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=v,r.method="throw",r.arg=u.arg)}}}(e,r,i),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l="suspendedStart",p="suspendedYield",h="executing",v="completed",w={};function y(){}function d(){}function x(){}var b={};b[i]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(L([])));m&&m!==r&&n.call(m,i)&&(b=m);var _=x.prototype=y.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function j(e){var t;this._invoke=function(r,o){function i(){return new Promise((function(t,i){!function t(r,o,i,c){var u=f(e[r],e,o);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"===a(l)&&n.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,i,c)}),(function(e){t("throw",e,i,c)})):Promise.resolve(l).then((function(e){s.value=e,i(s)}),(function(e){return t("throw",e,i,c)}))}c(u.arg)}(r,o,t,i)}))}return t=t?t.then(i,i):i()}}function F(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,F(e,r),"throw"===r.method))return w;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return w}var a=f(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,w;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,w):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,w)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function L(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return d.prototype=_.constructor=x,x.constructor=d,x[u]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},k(j.prototype),j.prototype[c]=function(){return this},e.AsyncIterator=j,e.async=function(t,r,n,a){var o=new j(s(t,r,n,a));return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(_),_[u]="Generator",_[i]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return c.type="throw",c.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,w):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),w},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),w}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;S(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:L(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),w}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),c=Array.isArray,u="object"==a(o)&&o&&o.Object===Object&&o,s="object"==("undefined"==typeof self?"undefined":a(self))&&self&&self.Object===Object&&self,f=u||s||Function("return this")(),l=f.Symbol,p=Object.prototype,h=p.hasOwnProperty,v=p.toString,w=l?l.toStringTag:void 0;var y=function(e){var t=h.call(e,w),r=e[w];try{e[w]=void 0;var n=!0}catch(e){}var a=v.call(e);return n&&(t?e[w]=r:delete e[w]),a},d=Object.prototype.toString;var x=function(e){return d.call(e)},b="[object Null]",g="[object Undefined]",m=l?l.toStringTag:void 0;var _=function(e){return null==e?void 0===e?g:b:m&&m in Object(e)?y(e):x(e)};var k=function(e){return null!=e&&"object"==a(e)},j="[object Symbol]";var F=function(e){return"symbol"==a(e)||k(e)&&_(e)==j},O=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S=/^\w*$/;var E=function(e,t){if(c(e))return!1;var r=a(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!F(e))||(S.test(e)||!O.test(e)||null!=t&&e in Object(t))};var L=function(e){var t=a(e);return null!=e&&("object"==t||"function"==t)},P="[object AsyncFunction]",$="[object Function]",N="[object GeneratorFunction]",T="[object Proxy]";var z,C=function(e){if(!L(e))return!1;var t=_(e);return t==$||t==N||t==P||t==T},A=f["__core-js_shared__"],G=(z=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"";var M=function(e){return!!G&&G in e},B=Function.prototype.toString;var I=function(e){if(null!=e){try{return B.call(e)}catch(e){}try{return e+""}catch(e){}}return""},q=/^\[object .+?Constructor\]$/,R=Function.prototype,U=Object.prototype,V=R.toString,Y=U.hasOwnProperty,D=RegExp("^"+V.call(Y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var H=function(e){return!(!L(e)||M(e))&&(C(e)?D:q).test(I(e))};var J=function(e,t){return null==e?void 0:e[t]};var K=function(e,t){var r=J(e,t);return H(r)?r:void 0},Q=K(Object,"create");var W=function(){this.__data__=Q?Q(null):{},this.size=0};var X=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Z="__lodash_hash_undefined__",ee=Object.prototype.hasOwnProperty;var te=function(e){var t=this.__data__;if(Q){var r=t[e];return r===Z?void 0:r}return ee.call(t,e)?t[e]:void 0},re=Object.prototype.hasOwnProperty;var ne=function(e){var t=this.__data__;return Q?void 0!==t[e]:re.call(t,e)},ae="__lodash_hash_undefined__";var oe=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Q&&void 0===t?ae:t,this};function ie(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ie.prototype.clear=W,ie.prototype.delete=X,ie.prototype.get=te,ie.prototype.has=ne,ie.prototype.set=oe;var ce=ie;var ue=function(){this.__data__=[],this.size=0};var se=function(e,t){return e===t||e!=e&&t!=t};var fe=function(e,t){for(var r=e.length;r--;)if(se(e[r][0],t))return r;return-1},le=Array.prototype.splice;var pe=function(e){var t=this.__data__,r=fe(t,e);return!(r<0)&&(r==t.length-1?t.pop():le.call(t,r,1),--this.size,!0)};var he=function(e){var t=this.__data__,r=fe(t,e);return r<0?void 0:t[r][1]};var ve=function(e){return fe(this.__data__,e)>-1};var we=function(e,t){var r=this.__data__,n=fe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function ye(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ye.prototype.clear=ue,ye.prototype.delete=pe,ye.prototype.get=he,ye.prototype.has=ve,ye.prototype.set=we;var de=ye,xe=K(f,"Map");var be=function(){this.size=0,this.__data__={hash:new ce,map:new(xe||de),string:new ce}};var ge=function(e){var t=a(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var me=function(e,t){var r=e.__data__;return ge(t)?r["string"==typeof t?"string":"hash"]:r.map};var _e=function(e){var t=me(this,e).delete(e);return this.size-=t?1:0,t};var ke=function(e){return me(this,e).get(e)};var je=function(e){return me(this,e).has(e)};var Fe=function(e,t){var r=me(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Oe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Oe.prototype.clear=be,Oe.prototype.delete=_e,Oe.prototype.get=ke,Oe.prototype.has=je,Oe.prototype.set=Fe;var Se=Oe,Ee="Expected a function";function Le(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Ee);var r=function r(){var n=arguments,a=t?t.apply(this,n):n[0],o=r.cache;if(o.has(a))return o.get(a);var i=e.apply(this,n);return r.cache=o.set(a,i)||o,i};return r.cache=new(Le.Cache||Se),r}Le.Cache=Se;var Pe=Le,$e=500;var Ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Te=/\\(\\)?/g,ze=function(e){var t=Pe(e,(function(e){return r.size===$e&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ne,(function(e,r,n,a){t.push(n?a.replace(Te,"$1"):r||e)})),t}));var Ce=function(e,t){for(var r=-1,n=null==e?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a},Ae=1/0,Ge=l?l.prototype:void 0,Me=Ge?Ge.toString:void 0;var Be=function e(t){if("string"==typeof t)return t;if(c(t))return Ce(t,e)+"";if(F(t))return Me?Me.call(t):"";var r=t+"";return"0"==r&&1/t==-Ae?"-0":r};var Ie=function(e){return null==e?"":Be(e)};var qe=function(e,t){return c(e)?e:E(e,t)?[e]:ze(Ie(e))},Re=1/0;var Ue=function(e){if("string"==typeof e||F(e))return e;var t=e+"";return"0"==t&&1/e==-Re?"-0":t};var Ve=function(e,t){for(var r=0,n=(t=qe(t,e)).length;null!=e&&r<n;)e=e[Ue(t[r++])];return r&&r==n?e:void 0};var Ye=function(e,t,r){var n=null==e?void 0:Ve(e,t);return void 0===n?r:n},De=NaN,He=/^\s+|\s+$/g,Je=/^[-+]0x[0-9a-f]+$/i,Ke=/^0b[01]+$/i,Qe=/^0o[0-7]+$/i,We=parseInt;var Xe=function(e){if("number"==typeof e)return e;if(F(e))return De;if(L(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=L(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(He,"");var r=Ke.test(e);return r||Qe.test(e)?We(e.slice(2),r?2:8):Je.test(e)?De:+e},Ze=1/0,et=17976931348623157e292;var tt=function(e){return e?(e=Xe(e))===Ze||e===-Ze?(e<0?-1:1)*et:e==e?e:0:0===e?e:0};var rt=function(e){var t=tt(e),r=t%1;return t==t?r?t-r:t:0};var nt=function(e){return"number"==typeof e&&e==rt(e)};function at(e){return"[object String]"===Object.prototype.toString.call(e)}function ot(e){var t=!1;return!function(e){return!(!at(e)||""===e)}(e)?function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)&&(t=!0):t=!isNaN(Number(e)),t}function it(e){return ot(e)?tt(e):0}function ct(e){return!!ot(e)&&(e=it(e),nt(e))}var ut=f.isFinite,st=Math.min;var ft=function(e){var t=Math[e];return function(e,r){if(e=Xe(e),(r=null==r?0:st(rt(r),292))&&ut(e)){var n=(Ie(e)+"e").split("e"),a=t(n[0]+"e"+(+n[1]+r));return+((n=(Ie(a)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");function lt(e){if(!ot(e))return 0;e=it(e);var t=ft(e);return"0"===String(t)?0:t}function pt(e){return"[object Object]"===Object.prototype.toString.call(e)}function ht(e){return"[object Array]"===Object.prototype.toString.call(e)}var vt="[object Boolean]";var wt=function(e){return!0===e||!1===e||k(e)&&_(e)==vt};function yt(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(pt(e)){for(var t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!at(e)||""!==e)}(e)||!!function(e){return!!ht(e)&&0===e.length}(e))))}function dt(t){var n,a,o,c,u,s,f,l,p,h,v=arguments;return i.async((function(w){for(;;)switch(w.prev=w.next){case 0:return p=function(e){var t,r,n,a,o=arguments;return i.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(0!==(t=lt(t=o.length>1&&void 0!==o[1]?o[1]:0))){c.next=11;break}return c.next=5,i.awrap(l.$(e));case 5:if(!yt(r=c.sent)){c.next=9;break}return console.log("page.$ get no result: "+e),c.abrupt("return",null);case 9:c.next=18;break;case 11:return c.next=13,i.awrap(l.$$(e));case 13:if(0!==(n=c.sent).length){c.next=17;break}return console.log("page.$$ get no result: "+e),c.abrupt("return",null);case 17:r=t<0?n[n.length+t]:n[t];case 18:if(!yt(r)){c.next=21;break}return console.log("invalid ele: "+e),c.abrupt("return",null);case 21:if(!yt(r.boundingBox)){c.next=24;break}return console.log("invalid ele.boundingBox: "+e),c.abrupt("return",null);case 24:return c.next=26,i.awrap(r.boundingBox());case 26:return(a=c.sent).cx=a.x+a.width/2,a.cy=a.y+a.height/2,a.ele=r,c.abrupt("return",a);case 31:case"end":return c.stop()}}))},n=v.length>1&&void 0!==v[1]?v[1]:{},a=Ye(n,"headless"),wt(a)||(a=!0),pt(o=Ye(n,"viewport"))||(o={x:0,y:0,width:800,height:600}),ht(c=Ye(n,"actions"))||(c=[]),ct(u=Ye(n,"waitsec"))||(u=5),s={headless:a,slowMo:20},w.next=13,i.awrap(r.launch(s));case 13:return f=w.sent,w.next=16,i.awrap(f.newPage());case 16:return l=w.sent,w.next=19,i.awrap(l.goto(t));case 19:return w.next=21,i.awrap(l.setViewport(o));case 21:return w.next=23,i.awrap(l.waitFor(1e3*u));case 23:return w.next=25,i.awrap(e.mapSeries(c,(function(e){var t,r,n,a,o,c,u,s;return i.async((function(f){for(;;)switch(f.prev=f.next){case 0:if("wait"!==e.mode){f.next=5;break}return f.next=3,i.awrap(l.waitFor(e.time));case 3:f.next=197;break;case 5:if("resize"!==e.mode){f.next=14;break}return f.next=8,i.awrap(l.waitFor(300));case 8:return f.next=10,i.awrap(l.setViewport({x:0,y:0,width:e.width,height:e.height}));case 10:return f.next=12,i.awrap(l.waitFor(300));case 12:f.next=197;break;case 14:if("move"!==e.mode){f.next=23;break}return f.next=17,i.awrap(l.waitFor(300));case 17:return f.next=19,i.awrap(l.mouse.move(e.x1,e.y1));case 19:return f.next=21,i.awrap(l.waitFor(300));case 21:f.next=197;break;case 23:if("elemove"!==e.mode){f.next=36;break}return f.next=26,i.awrap(l.waitFor(300));case 26:return f.next=28,i.awrap(p(e.selector,e.nth));case 28:if(!(t=f.sent)){f.next=34;break}return f.next=32,i.awrap(l.mouse.move(t.cx,t.cy));case 32:return f.next=34,i.awrap(l.waitFor(300));case 34:f.next=197;break;case 36:if("elehover"!==e.mode){f.next=45;break}return f.next=39,i.awrap(l.waitFor(300));case 39:return f.next=41,i.awrap(l.hover(e.selector));case 41:return f.next=43,i.awrap(l.waitFor(300));case 43:f.next=197;break;case 45:if("drag"!==e.mode){f.next=64;break}return f.next=48,i.awrap(l.waitFor(300));case 48:return f.next=50,i.awrap(l.mouse.move(e.x1,e.y1));case 50:return f.next=52,i.awrap(l.mouse.down());case 52:return f.next=54,i.awrap(l.waitFor(300));case 54:return f.next=56,i.awrap(l.mouse.move(e.x2,e.y2,{steps:50}));case 56:return f.next=58,i.awrap(l.waitFor(300));case 58:return f.next=60,i.awrap(l.mouse.up());case 60:return f.next=62,i.awrap(l.waitFor(300));case 62:f.next=197;break;case 64:if("eledrag"!==e.mode){f.next=87;break}return f.next=67,i.awrap(l.waitFor(300));case 67:return f.next=69,i.awrap(p(e.selector,e.nth));case 69:if(!(r=f.sent)){f.next=85;break}return f.next=73,i.awrap(l.mouse.move(r.cx,r.cy));case 73:return f.next=75,i.awrap(l.mouse.down());case 75:return f.next=77,i.awrap(l.waitFor(300));case 77:return f.next=79,i.awrap(l.mouse.move(r.cx+e.shiftx,r.cy+e.shifty,{steps:50}));case 79:return f.next=81,i.awrap(l.waitFor(300));case 81:return f.next=83,i.awrap(l.mouse.up());case 83:return f.next=85,i.awrap(l.waitFor(300));case 85:f.next=197;break;case 87:if("click"!==e.mode){f.next=100;break}return f.next=90,i.awrap(l.waitFor(300));case 90:return f.next=92,i.awrap(l.mouse.move(e.x1,e.y1));case 92:return f.next=94,i.awrap(l.mouse.down());case 94:return f.next=96,i.awrap(l.mouse.up());case 96:return f.next=98,i.awrap(l.waitFor(300));case 98:f.next=197;break;case 100:if("eleclick"!==e.mode){f.next=113;break}return f.next=103,i.awrap(l.waitFor(300));case 103:return f.next=105,i.awrap(p(e.selector,e.nth));case 105:if(!(n=f.sent)){f.next=111;break}return f.next=109,i.awrap(n.ele.click());case 109:return f.next=111,i.awrap(l.waitFor(300));case 111:f.next=197;break;case 113:if("dbclick"!==e.mode){f.next=122;break}return f.next=116,i.awrap(l.waitFor(300));case 116:return f.next=118,i.awrap(l.mouse.click(e.x1,e.y1,{clickCount:2}));case 118:return f.next=120,i.awrap(l.waitFor(300));case 120:f.next=197;break;case 122:if("eledbclick"!==e.mode){f.next=135;break}return f.next=125,i.awrap(l.waitFor(300));case 125:return f.next=127,i.awrap(p(e.selector,e.nth));case 127:if(!(a=f.sent)){f.next=133;break}return f.next=131,i.awrap(a.ele.click({clickCount:2}));case 131:return f.next=133,i.awrap(l.waitFor(300));case 133:f.next=197;break;case 135:if("type"!==e.mode){f.next=147;break}return f.next=138,i.awrap(l.waitFor(300));case 138:return f.next=140,i.awrap(l.keyboard.type(e.str,{delay:50}));case 140:if(e.noEnter){f.next=143;break}return f.next=143,i.awrap(l.keyboard.type(String.fromCharCode(13)));case 143:return f.next=145,i.awrap(l.waitFor(300));case 145:f.next=197;break;case 147:if("eletype"!==e.mode){f.next=167;break}return f.next=150,i.awrap(l.waitFor(300));case 150:return f.next=152,i.awrap(p(e.selector,e.nth));case 152:if(!(o=f.sent)){f.next=165;break}return f.next=156,i.awrap(o.ele.click());case 156:return f.next=158,i.awrap(l.waitFor(50));case 158:return f.next=160,i.awrap(l.keyboard.type(e.str,{delay:50}));case 160:if(e.noEnter){f.next=163;break}return f.next=163,i.awrap(l.keyboard.type(String.fromCharCode(13)));case 163:return f.next=165,i.awrap(l.waitFor(300));case 165:f.next=197;break;case 167:if("keypress"!==e.mode){f.next=183;break}return f.next=170,i.awrap(l.waitFor(300));case 170:(c=lt(e.count))<=0&&(c=1),u=0;case 173:if(!(u<c)){f.next=179;break}return f.next=176,i.awrap(l.keyboard.press(e.key));case 176:u++,f.next=173;break;case 179:return f.next=181,i.awrap(l.waitFor(300));case 181:f.next=197;break;case 183:if("elefocus"!==e.mode){f.next=196;break}return f.next=186,i.awrap(l.waitFor(300));case 186:return f.next=188,i.awrap(p(e.selector,e.nth));case 188:if(!(s=f.sent)){f.next=194;break}return f.next=192,i.awrap(s.ele.focus());case 192:return f.next=194,i.awrap(l.waitFor(300));case 194:f.next=197;break;case 196:console.log("mode is unrecognized: "+e.mode);case 197:case"end":return f.stop()}}))})));case 25:return w.next=27,i.awrap(l.waitFor(2e3));case 27:return w.next=29,i.awrap(l.screenshot({encoding:"base64"}));case 29:return h=w.sent,w.next=32,i.awrap(l.close());case 32:return w.next=34,i.awrap(f.close());case 34:return w.abrupt("return",h);case 35:case"end":return w.stop()}}))}function xt(e,t){if(e.length!==t.length)return 0;for(var r=0,n=e.length,a=0,o=e.length;a<o;a++){r+=Math.abs(e[a]-t[a])/255}return r=1-Math.pow(r/n,1/3)}function bt(e){var t,r;return i.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=Buffer.from(e,"base64"),a.next=3,i.awrap(n.read(t));case 3:return r=a.sent,a.abrupt("return",r.bitmap.data);case 5:case"end":return a.stop()}}))}function gt(e,t){var r,n;return i.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.awrap(bt(e));case 2:return r=a.sent,a.next=5,i.awrap(bt(t));case 5:return n=a.sent,a.abrupt("return",xt(r,n));case 7:case"end":return a.stop()}}))}return function(r){var n,a,o,c,u,s,f,l=arguments;return i.async((function(p){for(;;)switch(p.prev=p.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},a=Ye(n,"headless"),o=Ye(n,"viewport"),c=Ye(n,"waitsec"),u=10,ct(h=n.num_web)&&lt(h)>0&&(u=lt(n.num_web)),s=1,ot(n.ratio_similar)&&(s=it(n.ratio_similar)),f=!1,p.abrupt("return",e.map(r,(function(e){var r,n,u,l,p,h;return i.async((function(v){for(;;)switch(v.prev=v.next){case 0:return console.log("expTest: "+e.name),r={headless:a,viewport:o,actions:e.actions,waitsec:c},v.next=4,i.awrap(dt(e.url,r));case 4:if(n=v.sent,u=t.readFileSync(e.fn_base64,"utf8"),1!==s){v.next=10;break}l=n===u,v.next=16;break;case 10:return v.next=12,i.awrap(gt(n,u));case 12:p=v.sent,h=(l=p>=s)?" >= ":"<",console.log("ratio[".concat(p,"] ").concat(h," ratio_similar[").concat(s,"]"));case 16:if(!l){v.next=20;break}f||console.log("success: "+e.name),v.next=23;break;case 20:return f||(console.log("error: "+e.name),t.writeFileSync(e.name+".err.png",n,"base64")),f=!0,v.abrupt("return",Promise.reject(e.name));case 23:return v.abrupt("return",e.name);case 24:case"end":return v.stop()}}))}),{concurrency:u}).then((function(){console.log("[32m%s[0m","expTest success")})).catch((function(e){console.log("[31m%s[0m","expTest error: "+e)})));case 10:case"end":return p.stop()}var h}))}}));
//# sourceMappingURL=expTest.umd.js.map
