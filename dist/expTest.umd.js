/*!
 * expTest v1.0.28
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("bluebird"),require("fs"),require("puppeteer"),require("jimp")):"function"==typeof define&&define.amd?define(["bluebird","fs","puppeteer","jimp"],t):(e=e||self).expTest=t(e.bluebird,e.fs,e.puppeteer,e.jimp)}(this,(function(e,t,r,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var i=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function s(e,t,r,n){var o=t&&t.prototype instanceof d?t:d,a=Object.create(o.prototype),i=new E(n||[]);return a._invoke=function(e,t,r){var n=l;return function(o,a){if(n===h)throw new Error("Generator is already running");if(n===v){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var u=F(i,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=f(e,t,r);if("normal"===c.type){if(n=r.done?v:p,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=v,r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l="suspendedStart",p="suspendedYield",h="executing",v="completed",y={};function d(){}function x(){}function b(){}var m={};m[i]=function(){return this};var g=Object.getPrototypeOf,w=g&&g(g(L([])));w&&w!==r&&n.call(w,i)&&(m=w);var _=b.prototype=d.prototype=Object.create(m);function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function j(e){var t;this._invoke=function(r,a){function i(){return new Promise((function(t,i){!function t(r,a,i,u){var c=f(e[r],e,a);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"===o(l)&&n.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,i,u)}),(function(e){t("throw",e,i,u)})):Promise.resolve(l).then((function(e){s.value=e,i(s)}),(function(e){return t("throw",e,i,u)}))}u(c.arg)}(r,a,t,i)}))}return t=t?t.then(i,i):i()}}function F(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,F(e,r),"throw"===r.method))return y;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=f(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function L(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:t,done:!0}}return x.prototype=_.constructor=b,b.constructor=x,b[c]=x.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},k(j.prototype),j.prototype[u]=function(){return this},e.AsyncIterator=j,e.async=function(t,r,n,o){var a=new j(s(t,r,n,o));return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(_),_[c]="Generator",_[i]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],u=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:L(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function u(e,t,r,n,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}var c=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){u(a,n,o,i,c,"next",e)}function c(e){u(a,n,o,i,c,"throw",e)}i(void 0)}))}},s=Array.isArray,f="object"==o(a)&&a&&a.Object===Object&&a,l="object"==("undefined"==typeof self?"undefined":o(self))&&self&&self.Object===Object&&self,p=f||l||Function("return this")(),h=p.Symbol,v=Object.prototype,y=v.hasOwnProperty,d=v.toString,x=h?h.toStringTag:void 0;var b=function(e){var t=y.call(e,x),r=e[x];try{e[x]=void 0;var n=!0}catch(e){}var o=d.call(e);return n&&(t?e[x]=r:delete e[x]),o},m=Object.prototype.toString;var g=function(e){return m.call(e)},w="[object Null]",_="[object Undefined]",k=h?h.toStringTag:void 0;var j=function(e){return null==e?void 0===e?_:w:k&&k in Object(e)?b(e):g(e)};var F=function(e){return null!=e&&"object"==o(e)},O="[object Symbol]";var S=function(e){return"symbol"==o(e)||F(e)&&j(e)==O},E=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,L=/^\w*$/;var P=function(e,t){if(s(e))return!1;var r=o(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!S(e))||(L.test(e)||!E.test(e)||null!=t&&e in Object(t))};var $=function(e){var t=o(e);return null!=e&&("object"==t||"function"==t)},N="[object AsyncFunction]",T="[object Function]",z="[object GeneratorFunction]",C="[object Proxy]";var A,G=function(e){if(!$(e))return!1;var t=j(e);return t==T||t==z||t==N||t==C},M=p["__core-js_shared__"],B=(A=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"";var I=function(e){return!!B&&B in e},q=Function.prototype.toString;var R=function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""},U=/^\[object .+?Constructor\]$/,V=Function.prototype,Y=Object.prototype,D=V.toString,H=Y.hasOwnProperty,J=RegExp("^"+D.call(H).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var K=function(e){return!(!$(e)||I(e))&&(G(e)?J:U).test(R(e))};var Q=function(e,t){return null==e?void 0:e[t]};var W=function(e,t){var r=Q(e,t);return K(r)?r:void 0},X=W(Object,"create");var Z=function(){this.__data__=X?X(null):{},this.size=0};var ee=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},te="__lodash_hash_undefined__",re=Object.prototype.hasOwnProperty;var ne=function(e){var t=this.__data__;if(X){var r=t[e];return r===te?void 0:r}return re.call(t,e)?t[e]:void 0},oe=Object.prototype.hasOwnProperty;var ae=function(e){var t=this.__data__;return X?void 0!==t[e]:oe.call(t,e)},ie="__lodash_hash_undefined__";var ue=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=X&&void 0===t?ie:t,this};function ce(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ce.prototype.clear=Z,ce.prototype.delete=ee,ce.prototype.get=ne,ce.prototype.has=ae,ce.prototype.set=ue;var se=ce;var fe=function(){this.__data__=[],this.size=0};var le=function(e,t){return e===t||e!=e&&t!=t};var pe=function(e,t){for(var r=e.length;r--;)if(le(e[r][0],t))return r;return-1},he=Array.prototype.splice;var ve=function(e){var t=this.__data__,r=pe(t,e);return!(r<0)&&(r==t.length-1?t.pop():he.call(t,r,1),--this.size,!0)};var ye=function(e){var t=this.__data__,r=pe(t,e);return r<0?void 0:t[r][1]};var de=function(e){return pe(this.__data__,e)>-1};var xe=function(e,t){var r=this.__data__,n=pe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function be(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}be.prototype.clear=fe,be.prototype.delete=ve,be.prototype.get=ye,be.prototype.has=de,be.prototype.set=xe;var me=be,ge=W(p,"Map");var we=function(){this.size=0,this.__data__={hash:new se,map:new(ge||me),string:new se}};var _e=function(e){var t=o(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var ke=function(e,t){var r=e.__data__;return _e(t)?r["string"==typeof t?"string":"hash"]:r.map};var je=function(e){var t=ke(this,e).delete(e);return this.size-=t?1:0,t};var Fe=function(e){return ke(this,e).get(e)};var Oe=function(e){return ke(this,e).has(e)};var Se=function(e,t){var r=ke(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ee(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ee.prototype.clear=we,Ee.prototype.delete=je,Ee.prototype.get=Fe,Ee.prototype.has=Oe,Ee.prototype.set=Se;var Le=Ee,Pe="Expected a function";function $e(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Pe);var r=function r(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=e.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new($e.Cache||Le),r}$e.Cache=Le;var Ne=$e,Te=500;var ze=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ce=/\\(\\)?/g,Ae=function(e){var t=Ne(e,(function(e){return r.size===Te&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ze,(function(e,r,n,o){t.push(n?o.replace(Ce,"$1"):r||e)})),t}));var Ge=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o},Me=1/0,Be=h?h.prototype:void 0,Ie=Be?Be.toString:void 0;var qe=function e(t){if("string"==typeof t)return t;if(s(t))return Ge(t,e)+"";if(S(t))return Ie?Ie.call(t):"";var r=t+"";return"0"==r&&1/t==-Me?"-0":r};var Re=function(e){return null==e?"":qe(e)};var Ue=function(e,t){return s(e)?e:P(e,t)?[e]:Ae(Re(e))},Ve=1/0;var Ye=function(e){if("string"==typeof e||S(e))return e;var t=e+"";return"0"==t&&1/e==-Ve?"-0":t};var De=function(e,t){for(var r=0,n=(t=Ue(t,e)).length;null!=e&&r<n;)e=e[Ye(t[r++])];return r&&r==n?e:void 0};var He=function(e,t,r){var n=null==e?void 0:De(e,t);return void 0===n?r:n},Je=NaN,Ke=/^\s+|\s+$/g,Qe=/^[-+]0x[0-9a-f]+$/i,We=/^0b[01]+$/i,Xe=/^0o[0-7]+$/i,Ze=parseInt;var et=function(e){if("number"==typeof e)return e;if(S(e))return Je;if($(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=$(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Ke,"");var r=We.test(e);return r||Xe.test(e)?Ze(e.slice(2),r?2:8):Qe.test(e)?Je:+e},tt=1/0,rt=17976931348623157e292;var nt=function(e){return e?(e=et(e))===tt||e===-tt?(e<0?-1:1)*rt:e==e?e:0:0===e?e:0};var ot=function(e){var t=nt(e),r=t%1;return t==t?r?t-r:t:0};var at=function(e){return"number"==typeof e&&e==ot(e)};function it(e){return"[object String]"===Object.prototype.toString.call(e)}function ut(e){var t=!1;return!function(e){return!(!it(e)||""===e)}(e)?function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)&&(t=!0):t=!isNaN(Number(e)),t}function ct(e){return ut(e)?nt(e):0}function st(e){return!!ut(e)&&(e=ct(e),at(e))}var ft=p.isFinite,lt=Math.min;var pt=function(e){var t=Math[e];return function(e,r){if(e=et(e),(r=null==r?0:lt(ot(r),292))&&ft(e)){var n=(Re(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return+((n=(Re(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");function ht(e){if(!ut(e))return 0;e=ct(e);var t=pt(e);return"0"===String(t)?0:t}function vt(e){return!!st(e)&&ht(e)>0}function yt(e){return"[object Object]"===Object.prototype.toString.call(e)}function dt(e){return"[object Array]"===Object.prototype.toString.call(e)}var xt="[object Boolean]";var bt=function(e){return!0===e||!1===e||F(e)&&j(e)==xt};function mt(e){return bt(e)}function gt(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(yt(e)){for(var t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!it(e)||""!==e)}(e)||!!function(e){return!!dt(e)&&0===e.length}(e))))}function wt(e){return _t.apply(this,arguments)}function _t(){return(_t=c(i.mark((function t(n){var o,a,u,s,f,l,p,h,v,y,d,x=arguments;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y=function(){return(y=c(i.mark((function e(t){var r,n,o,a,u=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=ht(r=u.length>1&&void 0!==u[1]?u[1]:0))){e.next=11;break}return e.next=5,h.$(t);case 5:if(!gt(n=e.sent)){e.next=9;break}return console.log("page.$ get no result: "+t),e.abrupt("return",null);case 9:e.next=18;break;case 11:return e.next=13,h.$$(t);case 13:if(0!==(o=e.sent).length){e.next=17;break}return console.log("page.$$ get no result: "+t),e.abrupt("return",null);case 17:n=r<0?o[o.length+r]:o[r];case 18:if(!gt(n)){e.next=21;break}return console.log("invalid ele: "+t),e.abrupt("return",null);case 21:if(!gt(n.boundingBox)){e.next=24;break}return console.log("invalid ele.boundingBox: "+t),e.abrupt("return",null);case 24:return e.next=26,n.boundingBox();case 26:return(a=e.sent).cx=a.x+a.width/2,a.cy=a.y+a.height/2,a.ele=n,e.abrupt("return",a);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)},v=function(e){return y.apply(this,arguments)},o=x.length>1&&void 0!==x[1]?x[1]:{},mt(a=He(o,"headless"))||(a=!0),yt(u=He(o,"viewport"))||(u={x:0,y:0,width:800,height:600}),dt(s=He(o,"actions"))||(s=[]),st(f=He(o,"waitsec"))||(f=5),l={headless:a,slowMo:20},t.next=14,r.launch(l);case 14:return p=t.sent,t.next=17,p.newPage();case 17:return h=t.sent,t.next=20,h.goto(n);case 20:return t.next=22,h.setViewport(u);case 22:return t.next=24,h.waitFor(1e3*f);case 24:return t.next=26,e.mapSeries(s,function(){var e=c(i.mark((function e(t){var r,n,o,a,u,c,s,f;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wait"!==t.mode){e.next=5;break}return e.next=3,h.waitFor(t.time);case 3:e.next=197;break;case 5:if("resize"!==t.mode){e.next=14;break}return e.next=8,h.waitFor(300);case 8:return e.next=10,h.setViewport({x:0,y:0,width:t.width,height:t.height});case 10:return e.next=12,h.waitFor(300);case 12:e.next=197;break;case 14:if("move"!==t.mode){e.next=23;break}return e.next=17,h.waitFor(300);case 17:return e.next=19,h.mouse.move(t.x1,t.y1);case 19:return e.next=21,h.waitFor(300);case 21:e.next=197;break;case 23:if("elemove"!==t.mode){e.next=36;break}return e.next=26,h.waitFor(300);case 26:return e.next=28,v(t.selector,t.nth);case 28:if(!(r=e.sent)){e.next=34;break}return e.next=32,h.mouse.move(r.cx,r.cy);case 32:return e.next=34,h.waitFor(300);case 34:e.next=197;break;case 36:if("elehover"!==t.mode){e.next=45;break}return e.next=39,h.waitFor(300);case 39:return e.next=41,h.hover(t.selector);case 41:return e.next=43,h.waitFor(300);case 43:e.next=197;break;case 45:if("drag"!==t.mode){e.next=64;break}return e.next=48,h.waitFor(300);case 48:return e.next=50,h.mouse.move(t.x1,t.y1);case 50:return e.next=52,h.mouse.down();case 52:return e.next=54,h.waitFor(300);case 54:return e.next=56,h.mouse.move(t.x2,t.y2,{steps:50});case 56:return e.next=58,h.waitFor(300);case 58:return e.next=60,h.mouse.up();case 60:return e.next=62,h.waitFor(300);case 62:e.next=197;break;case 64:if("eledrag"!==t.mode){e.next=87;break}return e.next=67,h.waitFor(300);case 67:return e.next=69,v(t.selector,t.nth);case 69:if(!(n=e.sent)){e.next=85;break}return e.next=73,h.mouse.move(n.cx,n.cy);case 73:return e.next=75,h.mouse.down();case 75:return e.next=77,h.waitFor(300);case 77:return e.next=79,h.mouse.move(n.cx+t.shiftx,n.cy+t.shifty,{steps:50});case 79:return e.next=81,h.waitFor(300);case 81:return e.next=83,h.mouse.up();case 83:return e.next=85,h.waitFor(300);case 85:e.next=197;break;case 87:if("click"!==t.mode){e.next=100;break}return e.next=90,h.waitFor(300);case 90:return e.next=92,h.mouse.move(t.x1,t.y1);case 92:return e.next=94,h.mouse.down();case 94:return e.next=96,h.mouse.up();case 96:return e.next=98,h.waitFor(300);case 98:e.next=197;break;case 100:if("eleclick"!==t.mode){e.next=113;break}return e.next=103,h.waitFor(300);case 103:return e.next=105,v(t.selector,t.nth);case 105:if(!(o=e.sent)){e.next=111;break}return e.next=109,o.ele.click();case 109:return e.next=111,h.waitFor(300);case 111:e.next=197;break;case 113:if("dbclick"!==t.mode){e.next=122;break}return e.next=116,h.waitFor(300);case 116:return e.next=118,h.mouse.click(t.x1,t.y1,{clickCount:2});case 118:return e.next=120,h.waitFor(300);case 120:e.next=197;break;case 122:if("eledbclick"!==t.mode){e.next=135;break}return e.next=125,h.waitFor(300);case 125:return e.next=127,v(t.selector,t.nth);case 127:if(!(a=e.sent)){e.next=133;break}return e.next=131,a.ele.click({clickCount:2});case 131:return e.next=133,h.waitFor(300);case 133:e.next=197;break;case 135:if("type"!==t.mode){e.next=147;break}return e.next=138,h.waitFor(300);case 138:return e.next=140,h.keyboard.type(t.str,{delay:50});case 140:if(t.noEnter){e.next=143;break}return e.next=143,h.keyboard.type(String.fromCharCode(13));case 143:return e.next=145,h.waitFor(300);case 145:e.next=197;break;case 147:if("eletype"!==t.mode){e.next=167;break}return e.next=150,h.waitFor(300);case 150:return e.next=152,v(t.selector,t.nth);case 152:if(!(u=e.sent)){e.next=165;break}return e.next=156,u.ele.click();case 156:return e.next=158,h.waitFor(50);case 158:return e.next=160,h.keyboard.type(t.str,{delay:50});case 160:if(t.noEnter){e.next=163;break}return e.next=163,h.keyboard.type(String.fromCharCode(13));case 163:return e.next=165,h.waitFor(300);case 165:e.next=197;break;case 167:if("keypress"!==t.mode){e.next=183;break}return e.next=170,h.waitFor(300);case 170:(c=ht(t.count))<=0&&(c=1),s=0;case 173:if(!(s<c)){e.next=179;break}return e.next=176,h.keyboard.press(t.key);case 176:s++,e.next=173;break;case 179:return e.next=181,h.waitFor(300);case 181:e.next=197;break;case 183:if("elefocus"!==t.mode){e.next=196;break}return e.next=186,h.waitFor(300);case 186:return e.next=188,v(t.selector,t.nth);case 188:if(!(f=e.sent)){e.next=194;break}return e.next=192,f.ele.focus();case 192:return e.next=194,h.waitFor(300);case 194:e.next=197;break;case 196:console.log("mode is unrecognized: "+t.mode);case 197:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 26:return t.next=28,h.waitFor(2e3);case 28:return t.next=30,h.screenshot({encoding:"base64"});case 30:return d=t.sent,t.next=33,h.close();case 33:return t.next=35,p.close();case 35:return t.abrupt("return",d);case 36:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function kt(e,t){if(e.length!==t.length)return 0;for(var r=0,n=e.length,o=0,a=e.length;o<a;o++){r+=Math.abs(e[o]-t[o])/255}return r=1-Math.pow(r/n,1/3)}function jt(e){return Ft.apply(this,arguments)}function Ft(){return(Ft=c(i.mark((function e(t){var r,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Buffer.from(t,"base64"),e.next=3,n.read(r);case 3:return o=e.sent,e.abrupt("return",o.bitmap.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ot(e,t){return St.apply(this,arguments)}function St(){return(St=c(i.mark((function e(t,r){var n,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jt(t);case 2:return n=e.sent,e.next=5,jt(r);case 5:return o=e.sent,e.abrupt("return",kt(n,o));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Et(){return(Et=c(i.mark((function r(n){var o,a,u,s,f,l,p,h=arguments;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=h.length>1&&void 0!==h[1]?h[1]:{},a=He(o,"headless"),u=He(o,"viewport"),s=He(o,"waitsec"),f=10,vt(o.num_web)&&(f=ht(o.num_web)),l=1,ut(o.ratio_similar)&&(l=ct(o.ratio_similar)),p=!1,r.abrupt("return",e.map(n,function(){var e=c(i.mark((function e(r){var n,o,c,f,h,v;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("expTest: "+r.name),n={headless:a,viewport:u,actions:r.actions,waitsec:s},e.next=4,wt(r.url,n);case 4:if(o=e.sent,c=t.readFileSync(r.fn_base64,"utf8"),1!==l){e.next=10;break}f=o===c,e.next=16;break;case 10:return e.next=12,Ot(o,c);case 12:h=e.sent,v=(f=h>=l)?" >= ":"<",console.log("ratio[".concat(h,"] ").concat(v," ratio_similar[").concat(l,"]"));case 16:if(!f){e.next=20;break}p||console.log("success: "+r.name),e.next=23;break;case 20:return p||(console.log("error: "+r.name),t.writeFileSync(r.name+".err.png",o,"base64")),p=!0,e.abrupt("return",Promise.reject(r.name));case 23:return e.abrupt("return",r.name);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{concurrency:f}).then((function(){console.log("[32m%s[0m","expTest success")})).catch((function(e){console.log("[31m%s[0m","expTest error: "+e)})));case 10:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return function(e){return Et.apply(this,arguments)}}));
//# sourceMappingURL=expTest.umd.js.map
