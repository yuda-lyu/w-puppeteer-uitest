/*!
 * expTest v1.0.39
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fs"),require("puppeteer"),require("jimp")):"function"==typeof define&&define.amd?define(["fs","puppeteer","jimp"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).expTest=e(t.fs,t.puppeteer,t.jimp)}(this,(function(t,e,r){"use strict";var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var a=Array.isArray,i="object"==typeof n&&n&&n.Object===Object&&n,u=i,c="object"==typeof self&&self&&self.Object===Object&&self,s=u||c||Function("return this")(),l=s.Symbol,f=l,p=Object.prototype,v=p.hasOwnProperty,h=p.toString,y=f?f.toStringTag:void 0;var w=function(t){var e=v.call(t,y),r=t[y];try{t[y]=void 0;var n=!0}catch(t){}var o=h.call(t);return n&&(e?t[y]=r:delete t[y]),o},d=Object.prototype.toString;var b=w,g=function(t){return d.call(t)},m=l?l.toStringTag:void 0;var j=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":m&&m in Object(t)?b(t):g(t)};var _=function(t){return null!=t&&"object"==typeof t},x=j,O=_;var F=function(t){return"symbol"==typeof t||O(t)&&"[object Symbol]"==x(t)},k=a,S=F,A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$=/^\w*$/;var P=function(t,e){if(k(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!S(t))||($.test(t)||!A.test(t)||null!=e&&t in Object(e))};var T=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},C=j,z=T;var E,M=function(t){if(!z(t))return!1;var e=C(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},N=s["__core-js_shared__"],B=(E=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"";var I=function(t){return!!B&&B in t},L=Function.prototype.toString;var U=function(t){if(null!=t){try{return L.call(t)}catch(t){}try{return t+""}catch(t){}}return""},q=M,R=I,V=T,D=U,W=/^\[object .+?Constructor\]$/,G=Function.prototype,H=Object.prototype,J=G.toString,K=H.hasOwnProperty,Q=RegExp("^"+J.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var X=function(t){return!(!V(t)||R(t))&&(q(t)?Q:W).test(D(t))},Y=function(t,e){return null==t?void 0:t[e]};var Z=function(t,e){var r=Y(t,e);return X(r)?r:void 0},tt=Z(Object,"create"),et=tt;var rt=function(){this.__data__=et?et(null):{},this.size=0};var nt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ot=tt,at=Object.prototype.hasOwnProperty;var it=function(t){var e=this.__data__;if(ot){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return at.call(e,t)?e[t]:void 0},ut=tt,ct=Object.prototype.hasOwnProperty;var st=tt;var lt=rt,ft=nt,pt=it,vt=function(t){var e=this.__data__;return ut?void 0!==e[t]:ct.call(e,t)},ht=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=st&&void 0===e?"__lodash_hash_undefined__":e,this};function yt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}yt.prototype.clear=lt,yt.prototype.delete=ft,yt.prototype.get=pt,yt.prototype.has=vt,yt.prototype.set=ht;var wt=yt;var dt=function(){this.__data__=[],this.size=0};var bt=function(t,e){return t===e||t!=t&&e!=e};var gt=function(t,e){for(var r=t.length;r--;)if(bt(t[r][0],e))return r;return-1},mt=gt,jt=Array.prototype.splice;var _t=gt;var xt=gt;var Ot=gt;var Ft=dt,kt=function(t){var e=this.__data__,r=mt(e,t);return!(r<0)&&(r==e.length-1?e.pop():jt.call(e,r,1),--this.size,!0)},St=function(t){var e=this.__data__,r=_t(e,t);return r<0?void 0:e[r][1]},At=function(t){return xt(this.__data__,t)>-1},$t=function(t,e){var r=this.__data__,n=Ot(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function Pt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Pt.prototype.clear=Ft,Pt.prototype.delete=kt,Pt.prototype.get=St,Pt.prototype.has=At,Pt.prototype.set=$t;var Tt=Pt,Ct=Z(s,"Map"),zt=wt,Et=Tt,Mt=Ct;var Nt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Bt=function(t,e){var r=t.__data__;return Nt(e)?r["string"==typeof e?"string":"hash"]:r.map},It=Bt;var Lt=Bt;var Ut=Bt;var qt=Bt;var Rt=function(t,e){var r=qt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},Vt=function(){this.size=0,this.__data__={hash:new zt,map:new(Mt||Et),string:new zt}},Dt=function(t){var e=It(this,t).delete(t);return this.size-=e?1:0,e},Wt=function(t){return Lt(this,t).get(t)},Gt=function(t){return Ut(this,t).has(t)},Ht=Rt;function Jt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Jt.prototype.clear=Vt,Jt.prototype.delete=Dt,Jt.prototype.get=Wt,Jt.prototype.has=Gt,Jt.prototype.set=Ht;var Kt=Jt;function Qt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=t.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(Qt.Cache||Kt),r}Qt.Cache=Kt;var Xt=Qt;var Yt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Zt=/\\(\\)?/g,te=function(t){var e=Xt(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Yt,(function(t,r,n,o){e.push(n?o.replace(Zt,"$1"):r||t)})),e}));var ee=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},re=ee,ne=a,oe=F,ae=l?l.prototype:void 0,ie=ae?ae.toString:void 0;var ue=function t(e){if("string"==typeof e)return e;if(ne(e))return re(e,t)+"";if(oe(e))return ie?ie.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r},ce=ue;var se=function(t){return null==t?"":ce(t)},le=a,fe=P,pe=te,ve=se;var he=F;var ye=function(t,e){return le(t)?t:fe(t,e)?[t]:pe(ve(t))},we=function(t){if("string"==typeof t||he(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var de=function(t,e){for(var r=0,n=(e=ye(e,t)).length;null!=t&&r<n;)t=t[we(e[r++])];return r&&r==n?t:void 0};var be=function(t,e,r){var n=null==t?void 0:de(t,e);return void 0===n?r:n},ge=/\s/;var me=function(t){for(var e=t.length;e--&&ge.test(t.charAt(e)););return e},je=/^\s+/;var _e=function(t){return t?t.slice(0,me(t)+1).replace(je,""):t},xe=T,Oe=F,Fe=/^[-+]0x[0-9a-f]+$/i,ke=/^0b[01]+$/i,Se=/^0o[0-7]+$/i,Ae=parseInt;var $e=function(t){if("number"==typeof t)return t;if(Oe(t))return NaN;if(xe(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=xe(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=_e(t);var r=ke.test(t);return r||Se.test(t)?Ae(t.slice(2),r?2:8):Fe.test(t)?NaN:+t},Pe=$e,Te=1/0;var Ce=function(t){return t?(t=Pe(t))===Te||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},ze=Ce;var Ee=function(t){var e=ze(t),r=e%1;return e==e?r?e-r:e:0},Me=Ee;var Ne=function(t){return"number"==typeof t&&t==Me(t)};function Be(t){return"[object String]"===Object.prototype.toString.call(t)}function Ie(t){let e=!1;return!function(t){return!(!Be(t)||""===t)}(t)?function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0):e=!isNaN(Number(t)),e}function Le(t){if(!Ie(t))return 0;return Ce(t)}function Ue(t){return!!Ie(t)&&(t=Le(t),Ne(t))}var qe=Ee,Re=$e,Ve=se,De=s.isFinite,We=Math.min;var Ge=function(t){var e=Math[t];return function(t,r){if(t=Re(t),(r=null==r?0:We(qe(r),292))&&De(t)){var n=(Ve(t)+"e").split("e"),o=e(n[0]+"e"+(+n[1]+r));return+((n=(Ve(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");function He(t){if(!Ie(t))return 0;t=Le(t);let e=Ge(t);return"0"===String(e)?0:e}var Je={},Ke={get exports(){return Je},set exports(t){Je=t}};var Qe=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t};var Xe=function(t){return function(e,r,n){for(var o=-1,a=Object(e),i=n(e),u=i.length;u--;){var c=i[t?u:++o];if(!1===r(a[c],c,a))break}return e}}();var Ye=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},Ze=j,tr=_;var er=function(t){return tr(t)&&"[object Arguments]"==Ze(t)},rr=_,nr=Object.prototype,or=nr.hasOwnProperty,ar=nr.propertyIsEnumerable,ir=er(function(){return arguments}())?er:function(t){return rr(t)&&or.call(t,"callee")&&!ar.call(t,"callee")},ur=ir,cr={};var sr=function(){return!1};!function(t,e){var r=s,n=sr,o=e&&!e.nodeType&&e,a=o&&t&&!t.nodeType&&t,i=a&&a.exports===o?r.Buffer:void 0,u=(i?i.isBuffer:void 0)||n;t.exports=u}({get exports(){return cr},set exports(t){cr=t}},cr);var lr=/^(?:0|[1-9]\d*)$/;var fr=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&lr.test(t))&&t>-1&&t%1==0&&t<e};var pr=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},vr=j,hr=pr,yr=_,wr={};wr["[object Float32Array]"]=wr["[object Float64Array]"]=wr["[object Int8Array]"]=wr["[object Int16Array]"]=wr["[object Int32Array]"]=wr["[object Uint8Array]"]=wr["[object Uint8ClampedArray]"]=wr["[object Uint16Array]"]=wr["[object Uint32Array]"]=!0,wr["[object Arguments]"]=wr["[object Array]"]=wr["[object ArrayBuffer]"]=wr["[object Boolean]"]=wr["[object DataView]"]=wr["[object Date]"]=wr["[object Error]"]=wr["[object Function]"]=wr["[object Map]"]=wr["[object Number]"]=wr["[object Object]"]=wr["[object RegExp]"]=wr["[object Set]"]=wr["[object String]"]=wr["[object WeakMap]"]=!1;var dr=function(t){return yr(t)&&hr(t.length)&&!!wr[vr(t)]};var br=function(t){return function(e){return t(e)}},gr={};!function(t,e){var r=i,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,a=o&&o.exports===n&&r.process,u=function(){try{var t=o&&o.require&&o.require("util").types;return t||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=u}({get exports(){return gr},set exports(t){gr=t}},gr);var mr=dr,jr=br,_r=gr&&gr.isTypedArray,xr=_r?jr(_r):mr,Or=Ye,Fr=ur,kr=a,Sr=cr,Ar=fr,$r=xr,Pr=Object.prototype.hasOwnProperty;var Tr=function(t,e){var r=kr(t),n=!r&&Fr(t),o=!r&&!n&&Sr(t),a=!r&&!n&&!o&&$r(t),i=r||n||o||a,u=i?Or(t.length,String):[],c=u.length;for(var s in t)!e&&!Pr.call(t,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Ar(s,c))||u.push(s);return u},Cr=Object.prototype;var zr=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Cr)};var Er=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Mr=zr,Nr=Er,Br=Object.prototype.hasOwnProperty;var Ir=function(t){if(!Mr(t))return Nr(t);var e=[];for(var r in Object(t))Br.call(t,r)&&"constructor"!=r&&e.push(r);return e},Lr=M,Ur=pr;var qr=function(t){return null!=t&&Ur(t.length)&&!Lr(t)},Rr=Tr,Vr=Ir,Dr=qr;var Wr=function(t){return Dr(t)?Rr(t):Vr(t)},Gr=Xe,Hr=Wr;var Jr=qr;var Kr=function(t,e){return function(r,n){if(null==r)return r;if(!Jr(r))return t(r,n);for(var o=r.length,a=e?o:-1,i=Object(r);(e?a--:++a<o)&&!1!==n(i[a],a,i););return r}}((function(t,e){return t&&Gr(t,e,Hr)}));var Qr=function(t){return t};var Xr=Qe,Yr=Kr,Zr=function(t){return"function"==typeof t?t:Qr},tn=a;var en=function(t,e){return(tn(t)?Xr:Yr)(t,Zr(e))};!function(t){t.exports=en}(Ke);var rn=o(Je),nn=Z(s,"DataView"),on=Ct,an=Z(s,"Promise"),un=Z(s,"Set"),cn=Z(s,"WeakMap"),sn=j,ln=U,fn="[object Map]",pn="[object Promise]",vn="[object Set]",hn="[object WeakMap]",yn="[object DataView]",wn=ln(nn),dn=ln(on),bn=ln(an),gn=ln(un),mn=ln(cn),jn=sn;(nn&&jn(new nn(new ArrayBuffer(1)))!=yn||on&&jn(new on)!=fn||an&&jn(an.resolve())!=pn||un&&jn(new un)!=vn||cn&&jn(new cn)!=hn)&&(jn=function(t){var e=sn(t),r="[object Object]"==e?t.constructor:void 0,n=r?ln(r):"";if(n)switch(n){case wn:return yn;case dn:return fn;case bn:return pn;case gn:return vn;case mn:return hn}return e});var _n=jn,xn=j,On=a,Fn=_;var kn=function(t){return"string"==typeof t||!On(t)&&Fn(t)&&"[object String]"==xn(t)};var Sn=function(t){return function(e){return null==e?void 0:e[t]}}("length"),An=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var $n=function(t){return An.test(t)},Pn="\\ud800-\\udfff",Tn="["+Pn+"]",Cn="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",zn="\\ud83c[\\udffb-\\udfff]",En="[^"+Pn+"]",Mn="(?:\\ud83c[\\udde6-\\uddff]){2}",Nn="[\\ud800-\\udbff][\\udc00-\\udfff]",Bn="(?:"+Cn+"|"+zn+")"+"?",In="[\\ufe0e\\ufe0f]?",Ln=In+Bn+("(?:\\u200d(?:"+[En,Mn,Nn].join("|")+")"+In+Bn+")*"),Un="(?:"+[En+Cn+"?",Cn,Mn,Nn,Tn].join("|")+")",qn=RegExp(zn+"(?="+zn+")|"+Un+Ln,"g");var Rn=Sn,Vn=$n,Dn=function(t){for(var e=qn.lastIndex=0;qn.test(t);)++e;return e};var Wn=Ir,Gn=_n,Hn=qr,Jn=kn,Kn=function(t){return Vn(t)?Dn(t):Rn(t)};var Qn=function(t){if(null==t)return 0;if(Hn(t))return Jn(t)?Kn(t):t.length;var e=Gn(t);return"[object Map]"==e||"[object Set]"==e?t.size:Wn(t).length},Xn=ee;var Yn=function(t,e){return Xn(e,(function(e){return t[e]}))},Zn=Wr;var to=function(t){return null==t?[]:Yn(t,Zn(t))};function eo(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}function ro(t){return"[object Array]"===Object.prototype.toString.call(t)}function no(t){return"[object Object]"===Object.prototype.toString.call(t)}function oo(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}var ao={};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function a(t,e,n,a,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var u=new o(n,a||t,i),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],u]:t._events[c].push(u):(t._events[c]=u,t._eventsCount++),t}function i(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),u.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},u.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,a=n.length,i=new Array(a);o<a;o++)i[o]=n[o].fn;return i},u.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},u.prototype.emit=function(t,e,n,o,a,i){var u=r?r+t:t;if(!this._events[u])return!1;var c,s,l=this._events[u],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,o),!0;case 5:return l.fn.call(l.context,e,n,o,a),!0;case 6:return l.fn.call(l.context,e,n,o,a,i),!0}for(s=1,c=new Array(f-1);s<f;s++)c[s-1]=arguments[s];l.fn.apply(l.context,c)}else{var p,v=l.length;for(s=0;s<v;s++)switch(l[s].once&&this.removeListener(t,l[s].fn,void 0,!0),f){case 1:l[s].fn.call(l[s].context);break;case 2:l[s].fn.call(l[s].context,e);break;case 3:l[s].fn.call(l[s].context,e,n);break;case 4:l[s].fn.call(l[s].context,e,n,o);break;default:if(!c)for(p=1,c=new Array(f-1);p<f;p++)c[p-1]=arguments[p];l[s].fn.apply(l[s].context,c)}}return!0},u.prototype.on=function(t,e,r){return a(this,t,e,r,!1)},u.prototype.once=function(t,e,r){return a(this,t,e,r,!0)},u.prototype.removeListener=function(t,e,n,o){var a=r?r+t:t;if(!this._events[a])return this;if(!e)return i(this,a),this;var u=this._events[a];if(u.fn)u.fn!==e||o&&!u.once||n&&u.context!==n||i(this,a);else{for(var c=0,s=[],l=u.length;c<l;c++)(u[c].fn!==e||o&&!u[c].once||n&&u[c].context!==n)&&s.push(u[c]);s.length?this._events[a]=1===s.length?s[0]:s:i(this,a)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&i(this,e)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,t.exports=u}({get exports(){return ao},set exports(t){ao=t}});var io=ao;function uo(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=0,r=[];var n;Ue(n=t)&&He(n)<0&&(t=0),t=He(t);let o=new io;return o.get=function(){if(r.length>0){return e+=1,r.splice(0,1)[0]}return null},o.cb=function(){e-=1,e<0&&(e=0),r.length>0&&o.emit("message",r)},o.push=function(n){r.push(n),(t<=0||e<t)&&o.emit("message",r)},o.clear=function(){e=0,r=[]},o}var co=j,so=_;var lo=function(t){return!0===t||!1===t||so(t)&&"[object Boolean]"==co(t)};function fo(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(no(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!Be(t)||""!==t)}(t)||!!function(t){return!!ro(t)&&0===t.length}(t))))}var po=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(o);++n<o;)a[n]=t[n+e];return a},vo=Ee;var ho=function(t,e,r){var n=null==t?0:t.length;return n?(e=r||void 0===e?1:vo(e),po(t,e<0?0:e,n)):[]};async function yo(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=be(r,"headless");lo(n)||(n=!0);let o=be(r,"viewport");no(o)||(o={x:0,y:0,width:800,height:600});let a=be(r,"actions");ro(a)||(a=[]);let i=be(r,"waitsec");Ue(i)||(i=5);let u={headless:n,slowMo:20},c=await e.launch(u),s=await c.newPage();async function l(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r=He(r),0===r){if(e=await s.$(t),fo(e))return console.log("page.$ get no result: "+t),null}else{let n=await s.$$(t);if(0===n.length)return console.log("page.$$ get no result: "+t),null;e=r<0?n[n.length+r]:n[r]}if(fo(e))return console.log("invalid ele: "+t),null;if(fo(e.boundingBox))return console.log("invalid ele.boundingBox: "+t),null;let n=await e.boundingBox();return n.cx=n.x+n.width/2,n.cy=n.y+n.height/2,n.ele=e,n}await s.goto(t),await s.setViewport(o),await s.waitFor(1e3*i),await function(t,e){let r=eo();if(!ro(t)&&!no(t))return r.reject("rs is not an array or object"),r;let n=!1;if(no(t)){n=!0;let e=[];rn(t,((t,r)=>{e.push({k:r,v:t})})),t=e}oo(e)||(e=function(t){return t});let o=-1,a=[];return t.reduce((function(t,r){return t.then((function(t){a.push(t),o+=1;let i=o,u=r;return n&&(i=r.k,u=r.v),oo(e)?e(u,i):u}))}),Promise.resolve()).then((function(t){a.push(t),a=ho(a),r.resolve(a)})).catch((function(t){r.reject(t)})),r}(a,(async function(t){if("wait"===t.mode)await s.waitFor(t.time);else if("resize"===t.mode)await s.waitFor(300),await s.setViewport({x:0,y:0,width:t.width,height:t.height}),await s.waitFor(300);else if("move"===t.mode)await s.waitFor(300),await s.mouse.move(t.x1,t.y1),await s.waitFor(300);else if("elemove"===t.mode){await s.waitFor(300);let e=await l(t.selector,t.nth);e&&(await s.mouse.move(e.cx,e.cy),await s.waitFor(300))}else if("elehover"===t.mode)await s.waitFor(300),await s.hover(t.selector),await s.waitFor(300);else if("drag"===t.mode)await s.waitFor(300),await s.mouse.move(t.x1,t.y1),await s.mouse.down(),await s.waitFor(300),await s.mouse.move(t.x2,t.y2,{steps:50}),await s.waitFor(300),await s.mouse.up(),await s.waitFor(300);else if("eledrag"===t.mode){await s.waitFor(300);let e=await l(t.selector,t.nth);e&&(await s.mouse.move(e.cx,e.cy),await s.mouse.down(),await s.waitFor(300),await s.mouse.move(e.cx+t.shiftx,e.cy+t.shifty,{steps:50}),await s.waitFor(300),await s.mouse.up(),await s.waitFor(300))}else if("click"===t.mode)await s.waitFor(300),await s.mouse.move(t.x1,t.y1),await s.mouse.down(),await s.mouse.up(),await s.waitFor(300);else if("eleclick"===t.mode){await s.waitFor(300);let e=await l(t.selector,t.nth);e&&(await e.ele.click(),await s.waitFor(300))}else if("dbclick"===t.mode)await s.waitFor(300),await s.mouse.click(t.x1,t.y1,{clickCount:2}),await s.waitFor(300);else if("eledbclick"===t.mode){await s.waitFor(300);let e=await l(t.selector,t.nth);e&&(await e.ele.click({clickCount:2}),await s.waitFor(300))}else if("type"===t.mode)await s.waitFor(300),await s.keyboard.type(t.str,{delay:50}),t.noEnter||await s.keyboard.type(String.fromCharCode(13)),await s.waitFor(300);else if("eletype"===t.mode){await s.waitFor(300);let e=await l(t.selector,t.nth);e&&(await e.ele.click(),await s.waitFor(50),await s.keyboard.type(t.str,{delay:50}),t.noEnter||await s.keyboard.type(String.fromCharCode(13)),await s.waitFor(300))}else if("keypress"===t.mode){await s.waitFor(300);let e=He(t.count);e<=0&&(e=1);for(let r=0;r<e;r++)await s.keyboard.press(t.key);await s.waitFor(300)}else if("elefocus"===t.mode){await s.waitFor(300);let e=await l(t.selector,t.nth);e&&(await e.ele.focus(),await s.waitFor(300))}else console.log("mode is unrecognized: "+t.mode)})),await s.waitFor(2e3);let f=await s.screenshot({encoding:"base64"});return await s.close(),await c.close(),f}async function wo(t){let e=Buffer.from(t,"base64");return(await r.read(e)).bitmap.data}async function bo(t,e){return function(t,e){if(t.length!==e.length)return 0;let r=0,n=t.length;for(let n=0,o=t.length;n<o;n++)r+=Math.abs(t[n]-e[n])/255;return r=1-Math.pow(r/n,1/3),r}(await wo(t),await wo(e))}return async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=be(r,"headless"),o=be(r,"viewport"),a=be(r,"waitsec"),i=10;var u;Ue(u=r.num_web)&&He(u)>0&&(i=He(r.num_web));let c=1;Ie(r.ratio_similar)&&(c=Le(r.ratio_similar));let s=!1;return function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n={},o=!1,a=eo();if(!ro(t)&&!no(t))return a.reject("rs is not an array or object"),a;let i=!1;if(no(t)){i=!0;let e=[];rn(t,((t,r)=>{e.push({k:r,v:t})})),t=e}let u=uo(r);return u.on("message",(function(r){if(o)return;let c,s=u.get();if(oo(e)){let t=s.key,r=s.value;i&&(t=s.value.k,r=s.value.v),c=e(r,t)}else c=s.value;c.then((t=>{n[s.key]=t})).catch((t=>{o=!0,u.clear(),a.reject(t)})).finally((()=>{u.cb(),Qn(n)===t.length&&a.resolve(to(n))}))})),rn(t,((t,e)=>{u.push({key:e,value:t})})),a}(e,(async function(e){console.log("expTest: "+e.name);let r,i={headless:n,viewport:o,actions:e.actions,waitsec:a},u=await yo(e.url,i),l=t.readFileSync(e.fn_base64,"utf8");if(1===c)r=u===l;else{let t=await bo(u,l);r=t>=c;let e=r?" >= ":"<";console.log(`ratio[${t}] ${e} ratio_similar[${c}]`)}return r?(s||console.log("success: "+e.name),e.name):(s||(console.log("error: "+e.name),t.writeFileSync(e.name+".err.png",u,"base64")),s=!0,Promise.reject(e.name))}),i).then((()=>{console.log("[32m%s[0m","expTest success")})).catch((t=>{console.log("[31m%s[0m","expTest error: "+t)}))}}));
//# sourceMappingURL=expTest.umd.js.map
