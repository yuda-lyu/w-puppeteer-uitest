/*!
 * exp v1.0.38
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fs"),require("puppeteer"),require("jimp"),require("json5")):"function"==typeof define&&define.amd?define(["exports","fs","puppeteer","jimp","json5"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).exp={},t.fs,t.puppeteer,t.jimp,t.json5)}(this,(function(t,e,r,n,o){"use strict";var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o};var c=function(){this.__data__=[],this.size=0};var s=function(t,e){return t===e||t!=t&&e!=e},f=s;var l=function(t,e){for(var r=t.length;r--;)if(f(t[r][0],e))return r;return-1},v=l,p=Array.prototype.splice;var h=l;var y=l;var d=l;var w=c,b=function(t){var e=this.__data__,r=v(e,t);return!(r<0)&&(r==e.length-1?e.pop():p.call(e,r,1),--this.size,!0)},g=function(t){var e=this.__data__,r=h(e,t);return r<0?void 0:e[r][1]},_=function(t){return y(this.__data__,t)>-1},m=function(t,e){var r=this.__data__,n=d(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function j(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}j.prototype.clear=w,j.prototype.delete=b,j.prototype.get=g,j.prototype.has=_,j.prototype.set=m;var x=j,O=x;var F=function(){this.__data__=new O,this.size=0};var S=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var k=function(t){return this.__data__.get(t)};var A=function(t){return this.__data__.has(t)},z="object"==typeof i&&i&&i.Object===Object&&i,P=z,$="object"==typeof self&&self&&self.Object===Object&&self,E=P||$||Function("return this")(),T=E.Symbol,C=T,B=Object.prototype,M=B.hasOwnProperty,N=B.toString,L=C?C.toStringTag:void 0;var I=function(t){var e=M.call(t,L),r=t[L];try{t[L]=void 0;var n=!0}catch(t){}var o=N.call(t);return n&&(e?t[L]=r:delete t[L]),o},U=Object.prototype.toString;var q=I,D=function(t){return U.call(t)},R=T?T.toStringTag:void 0;var V=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":R&&R in Object(t)?q(t):D(t)};var W=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},G=V,H=W;var J,K=function(t){if(!H(t))return!1;var e=G(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Q=E["__core-js_shared__"],X=(J=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"";var Y=function(t){return!!X&&X in t},Z=Function.prototype.toString;var tt=function(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""},et=K,rt=Y,nt=W,ot=tt,it=/^\[object .+?Constructor\]$/,at=Function.prototype,ut=Object.prototype,ct=at.toString,st=ut.hasOwnProperty,ft=RegExp("^"+ct.call(st).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var lt=function(t){return!(!nt(t)||rt(t))&&(et(t)?ft:it).test(ot(t))},vt=function(t,e){return null==t?void 0:t[e]};var pt=function(t,e){var r=vt(t,e);return lt(r)?r:void 0},ht=pt(E,"Map"),yt=pt(Object,"create"),dt=yt;var wt=function(){this.__data__=dt?dt(null):{},this.size=0};var bt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},gt=yt,_t=Object.prototype.hasOwnProperty;var mt=function(t){var e=this.__data__;if(gt){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return _t.call(e,t)?e[t]:void 0},jt=yt,xt=Object.prototype.hasOwnProperty;var Ot=yt;var Ft=wt,St=bt,kt=mt,At=function(t){var e=this.__data__;return jt?void 0!==e[t]:xt.call(e,t)},zt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ot&&void 0===e?"__lodash_hash_undefined__":e,this};function Pt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Pt.prototype.clear=Ft,Pt.prototype.delete=St,Pt.prototype.get=kt,Pt.prototype.has=At,Pt.prototype.set=zt;var $t=Pt,Et=x,Tt=ht;var Ct=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Bt=function(t,e){var r=t.__data__;return Ct(e)?r["string"==typeof e?"string":"hash"]:r.map},Mt=Bt;var Nt=Bt;var Lt=Bt;var It=Bt;var Ut=function(t,e){var r=It(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},qt=function(){this.size=0,this.__data__={hash:new $t,map:new(Tt||Et),string:new $t}},Dt=function(t){var e=Mt(this,t).delete(t);return this.size-=e?1:0,e},Rt=function(t){return Nt(this,t).get(t)},Vt=function(t){return Lt(this,t).has(t)},Wt=Ut;function Gt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Gt.prototype.clear=qt,Gt.prototype.delete=Dt,Gt.prototype.get=Rt,Gt.prototype.has=Vt,Gt.prototype.set=Wt;var Ht=Gt,Jt=x,Kt=ht,Qt=Ht;var Xt=x,Yt=F,Zt=S,te=k,ee=A,re=function(t,e){var r=this.__data__;if(r instanceof Jt){var n=r.__data__;if(!Kt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Qt(n)}return r.set(t,e),this.size=r.size,this};function ne(t){var e=this.__data__=new Xt(t);this.size=e.size}ne.prototype.clear=Yt,ne.prototype.delete=Zt,ne.prototype.get=te,ne.prototype.has=ee,ne.prototype.set=re;var oe=ne;var ie=Ht,ae=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ue=function(t){return this.__data__.has(t)};function ce(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new ie;++e<r;)this.add(t[e])}ce.prototype.add=ce.prototype.push=ae,ce.prototype.has=ue;var se=ce,fe=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},le=function(t,e){return t.has(e)};var ve=function(t,e,r,n,o,i){var a=1&r,u=t.length,c=e.length;if(u!=c&&!(a&&c>u))return!1;var s=i.get(t),f=i.get(e);if(s&&f)return s==e&&f==t;var l=-1,v=!0,p=2&r?new se:void 0;for(i.set(t,e),i.set(e,t);++l<u;){var h=t[l],y=e[l];if(n)var d=a?n(y,h,l,e,t,i):n(h,y,l,t,e,i);if(void 0!==d){if(d)continue;v=!1;break}if(p){if(!fe(e,(function(t,e){if(!le(p,e)&&(h===t||o(h,t,r,n,i)))return p.push(e)}))){v=!1;break}}else if(h!==y&&!o(h,y,r,n,i)){v=!1;break}}return i.delete(t),i.delete(e),v};var pe=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var he=E.Uint8Array,ye=s,de=ve,we=pe,be=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},ge=T?T.prototype:void 0,_e=ge?ge.valueOf:void 0;var me=function(t,e,r,n,o,i,a){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new he(t),new he(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ye(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var u=we;case"[object Set]":var c=1&n;if(u||(u=be),t.size!=e.size&&!c)return!1;var s=a.get(t);if(s)return s==e;n|=2,a.set(t,e);var f=de(u(t),u(e),n,o,i,a);return a.delete(t),f;case"[object Symbol]":if(_e)return _e.call(t)==_e.call(e)}return!1};var je=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},xe=Array.isArray,Oe=je,Fe=xe;var Se=function(t,e,r){var n=e(t);return Fe(t)?n:Oe(n,r(t))};var ke=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[o++]=a)}return i},Ae=function(){return[]},ze=Object.prototype.propertyIsEnumerable,Pe=Object.getOwnPropertySymbols,$e=Pe?function(t){return null==t?[]:(t=Object(t),ke(Pe(t),(function(e){return ze.call(t,e)})))}:Ae;var Ee=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Te=function(t){return null!=t&&"object"==typeof t},Ce=V,Be=Te;var Me=function(t){return Be(t)&&"[object Arguments]"==Ce(t)},Ne=Te,Le=Object.prototype,Ie=Le.hasOwnProperty,Ue=Le.propertyIsEnumerable,qe=Me(function(){return arguments}())?Me:function(t){return Ne(t)&&Ie.call(t,"callee")&&!Ue.call(t,"callee")},De=qe,Re={};var Ve=function(){return!1};!function(t,e){var r=E,n=Ve,o=e&&!e.nodeType&&e,i=o&&t&&!t.nodeType&&t,a=i&&i.exports===o?r.Buffer:void 0,u=(a?a.isBuffer:void 0)||n;t.exports=u}({get exports(){return Re},set exports(t){Re=t}},Re);var We=/^(?:0|[1-9]\d*)$/;var Ge=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&We.test(t))&&t>-1&&t%1==0&&t<e};var He=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},Je=V,Ke=He,Qe=Te,Xe={};Xe["[object Float32Array]"]=Xe["[object Float64Array]"]=Xe["[object Int8Array]"]=Xe["[object Int16Array]"]=Xe["[object Int32Array]"]=Xe["[object Uint8Array]"]=Xe["[object Uint8ClampedArray]"]=Xe["[object Uint16Array]"]=Xe["[object Uint32Array]"]=!0,Xe["[object Arguments]"]=Xe["[object Array]"]=Xe["[object ArrayBuffer]"]=Xe["[object Boolean]"]=Xe["[object DataView]"]=Xe["[object Date]"]=Xe["[object Error]"]=Xe["[object Function]"]=Xe["[object Map]"]=Xe["[object Number]"]=Xe["[object Object]"]=Xe["[object RegExp]"]=Xe["[object Set]"]=Xe["[object String]"]=Xe["[object WeakMap]"]=!1;var Ye=function(t){return Qe(t)&&Ke(t.length)&&!!Xe[Je(t)]};var Ze=function(t){return function(e){return t(e)}},tr={};!function(t,e){var r=z,n=e&&!e.nodeType&&e,o=n&&t&&!t.nodeType&&t,i=o&&o.exports===n&&r.process,a=function(){try{var t=o&&o.require&&o.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=a}({get exports(){return tr},set exports(t){tr=t}},tr);var er=Ye,rr=Ze,nr=tr&&tr.isTypedArray,or=nr?rr(nr):er,ir=Ee,ar=De,ur=xe,cr=Re,sr=Ge,fr=or,lr=Object.prototype.hasOwnProperty;var vr=function(t,e){var r=ur(t),n=!r&&ar(t),o=!r&&!n&&cr(t),i=!r&&!n&&!o&&fr(t),a=r||n||o||i,u=a?ir(t.length,String):[],c=u.length;for(var s in t)!e&&!lr.call(t,s)||a&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||sr(s,c))||u.push(s);return u},pr=Object.prototype;var hr=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||pr)};var yr=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),dr=hr,wr=yr,br=Object.prototype.hasOwnProperty;var gr=function(t){if(!dr(t))return wr(t);var e=[];for(var r in Object(t))br.call(t,r)&&"constructor"!=r&&e.push(r);return e},_r=K,mr=He;var jr=function(t){return null!=t&&mr(t.length)&&!_r(t)},xr=vr,Or=gr,Fr=jr;var Sr=function(t){return Fr(t)?xr(t):Or(t)},kr=Se,Ar=$e,zr=Sr;var Pr=function(t){return kr(t,zr,Ar)},$r=Object.prototype.hasOwnProperty;var Er=function(t,e,r,n,o,i){var a=1&r,u=Pr(t),c=u.length;if(c!=Pr(e).length&&!a)return!1;for(var s=c;s--;){var f=u[s];if(!(a?f in e:$r.call(e,f)))return!1}var l=i.get(t),v=i.get(e);if(l&&v)return l==e&&v==t;var p=!0;i.set(t,e),i.set(e,t);for(var h=a;++s<c;){var y=t[f=u[s]],d=e[f];if(n)var w=a?n(d,y,f,e,t,i):n(y,d,f,t,e,i);if(!(void 0===w?y===d||o(y,d,r,n,i):w)){p=!1;break}h||(h="constructor"==f)}if(p&&!h){var b=t.constructor,g=e.constructor;b==g||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof g&&g instanceof g||(p=!1)}return i.delete(t),i.delete(e),p},Tr=pt(E,"DataView"),Cr=ht,Br=pt(E,"Promise"),Mr=pt(E,"Set"),Nr=pt(E,"WeakMap"),Lr=V,Ir=tt,Ur="[object Map]",qr="[object Promise]",Dr="[object Set]",Rr="[object WeakMap]",Vr="[object DataView]",Wr=Ir(Tr),Gr=Ir(Cr),Hr=Ir(Br),Jr=Ir(Mr),Kr=Ir(Nr),Qr=Lr;(Tr&&Qr(new Tr(new ArrayBuffer(1)))!=Vr||Cr&&Qr(new Cr)!=Ur||Br&&Qr(Br.resolve())!=qr||Mr&&Qr(new Mr)!=Dr||Nr&&Qr(new Nr)!=Rr)&&(Qr=function(t){var e=Lr(t),r="[object Object]"==e?t.constructor:void 0,n=r?Ir(r):"";if(n)switch(n){case Wr:return Vr;case Gr:return Ur;case Hr:return qr;case Jr:return Dr;case Kr:return Rr}return e});var Xr=Qr,Yr=oe,Zr=ve,tn=me,en=Er,rn=Xr,nn=xe,on=Re,an=or,un="[object Arguments]",cn="[object Array]",sn="[object Object]",fn=Object.prototype.hasOwnProperty;var ln=function(t,e,r,n,o,i){var a=nn(t),u=nn(e),c=a?cn:rn(t),s=u?cn:rn(e),f=(c=c==un?sn:c)==sn,l=(s=s==un?sn:s)==sn,v=c==s;if(v&&on(t)){if(!on(e))return!1;a=!0,f=!1}if(v&&!f)return i||(i=new Yr),a||an(t)?Zr(t,e,r,n,o,i):tn(t,e,c,r,n,o,i);if(!(1&r)){var p=f&&fn.call(t,"__wrapped__"),h=l&&fn.call(e,"__wrapped__");if(p||h){var y=p?t.value():t,d=h?e.value():e;return i||(i=new Yr),o(y,d,r,n,i)}}return!!v&&(i||(i=new Yr),en(t,e,r,n,o,i))},vn=Te;var pn=function t(e,r,n,o,i){return e===r||(null==e||null==r||!vn(e)&&!vn(r)?e!=e&&r!=r:ln(e,r,n,o,t,i))},hn=oe,yn=pn;var dn=W;var wn=function(t){return t==t&&!dn(t)},bn=wn,gn=Sr;var _n=function(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}},mn=function(t,e,r,n){var o=r.length,i=o,a=!n;if(null==t)return!i;for(t=Object(t);o--;){var u=r[o];if(a&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++o<i;){var c=(u=r[o])[0],s=t[c],f=u[1];if(a&&u[2]){if(void 0===s&&!(c in t))return!1}else{var l=new hn;if(n)var v=n(s,f,c,t,e,l);if(!(void 0===v?yn(f,s,3,n,l):v))return!1}}return!0},jn=function(t){for(var e=gn(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,bn(o)]}return e},xn=_n;var On=function(t){var e=jn(t);return 1==e.length&&e[0][2]?xn(e[0][0],e[0][1]):function(r){return r===t||mn(r,t,e)}},Fn=V,Sn=Te;var kn=function(t){return"symbol"==typeof t||Sn(t)&&"[object Symbol]"==Fn(t)},An=xe,zn=kn,Pn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$n=/^\w*$/;var En=function(t,e){if(An(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!zn(t))||($n.test(t)||!Pn.test(t)||null!=e&&t in Object(e))},Tn=Ht;function Cn(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(Cn.Cache||Tn),r}Cn.Cache=Tn;var Bn=Cn;var Mn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Nn=/\\(\\)?/g,Ln=function(t){var e=Bn(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Mn,(function(t,r,n,o){e.push(n?o.replace(Nn,"$1"):r||t)})),e})),In=u,Un=xe,qn=kn,Dn=T?T.prototype:void 0,Rn=Dn?Dn.toString:void 0;var Vn=function t(e){if("string"==typeof e)return e;if(Un(e))return In(e,t)+"";if(qn(e))return Rn?Rn.call(e):"";var r=e+"";return"0"==r&&1/e==-Infinity?"-0":r},Wn=Vn;var Gn=function(t){return null==t?"":Wn(t)},Hn=xe,Jn=En,Kn=Ln,Qn=Gn;var Xn=function(t,e){return Hn(t)?t:Jn(t,e)?[t]:Kn(Qn(t))},Yn=kn;var Zn=function(t){if("string"==typeof t||Yn(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},to=Xn,eo=Zn;var ro=function(t,e){for(var r=0,n=(e=to(e,t)).length;null!=t&&r<n;)t=t[eo(e[r++])];return r&&r==n?t:void 0},no=ro;var oo=function(t,e,r){var n=null==t?void 0:no(t,e);return void 0===n?r:n};var io=Xn,ao=De,uo=xe,co=Ge,so=He,fo=Zn;var lo=function(t,e){return null!=t&&e in Object(t)},vo=function(t,e,r){for(var n=-1,o=(e=io(e,t)).length,i=!1;++n<o;){var a=fo(e[n]);if(!(i=null!=t&&r(t,a)))break;t=t[a]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&so(o)&&co(a,o)&&(uo(t)||ao(t))};var po=pn,ho=oo,yo=function(t,e){return null!=t&&vo(t,e,lo)},wo=En,bo=wn,go=_n,_o=Zn;var mo=function(t){return t};var jo=function(t){return function(e){return null==e?void 0:e[t]}},xo=ro;var Oo=jo,Fo=function(t){return function(e){return xo(e,t)}},So=En,ko=Zn;var Ao=On,zo=function(t,e){return wo(t)&&bo(e)?go(_o(t),e):function(r){var n=ho(r,t);return void 0===n&&n===e?yo(r,t):po(e,n,3)}},Po=mo,$o=xe,Eo=function(t){return So(t)?Oo(ko(t)):Fo(t)};var To=function(t){return"function"==typeof t?t:null==t?Po:"object"==typeof t?$o(t)?zo(t[0],t[1]):Ao(t):Eo(t)};var Co=function(t){return function(e,r,n){for(var o=-1,i=Object(e),a=n(e),u=a.length;u--;){var c=a[t?u:++o];if(!1===r(i[c],c,i))break}return e}}(),Bo=Sr;var Mo=jr;var No=function(t,e){return function(r,n){if(null==r)return r;if(!Mo(r))return t(r,n);for(var o=r.length,i=e?o:-1,a=Object(r);(e?i--:++i<o)&&!1!==n(a[i],i,a););return r}}((function(t,e){return t&&Co(t,e,Bo)})),Lo=No,Io=jr;var Uo=u,qo=To,Do=function(t,e){var r=-1,n=Io(t)?Array(t.length):[];return Lo(t,(function(t,o,i){n[++r]=e(t,o,i)})),n},Ro=xe;var Vo=function(t,e){return(Ro(t)?Uo:Do)(t,qo(e))},Wo=/\s/;var Go=function(t){for(var e=t.length;e--&&Wo.test(t.charAt(e)););return e},Ho=/^\s+/;var Jo=function(t){return t?t.slice(0,Go(t)+1).replace(Ho,""):t},Ko=W,Qo=kn,Xo=/^[-+]0x[0-9a-f]+$/i,Yo=/^0b[01]+$/i,Zo=/^0o[0-7]+$/i,ti=parseInt;var ei=function(t){if("number"==typeof t)return t;if(Qo(t))return NaN;if(Ko(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ko(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Jo(t);var r=Yo.test(t);return r||Zo.test(t)?ti(t.slice(2),r?2:8):Xo.test(t)?NaN:+t},ri=ei,ni=1/0;var oi=function(t){return t?(t=ri(t))===ni||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},ii=oi;var ai=function(t){var e=ii(t),r=e%1;return e==e?r?e-r:e:0},ui=ai;var ci=function(t){return"number"==typeof t&&t==ui(t)};function si(t){return"[object String]"===Object.prototype.toString.call(t)}function fi(t){let e=!1;return!function(t){return!(!si(t)||""===t)}(t)?function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)&&(e=!0):e=!isNaN(Number(t)),e}function li(t){if(!fi(t))return 0;return oi(t)}function vi(t){return!!fi(t)&&(t=li(t),ci(t))}var pi=ai,hi=ei,yi=Gn,di=E.isFinite,wi=Math.min;var bi=function(t){var e=Math[t];return function(t,r){if(t=hi(t),(r=null==r?0:wi(pi(r),292))&&di(t)){var n=(yi(t)+"e").split("e"),o=e(n[0]+"e"+(+n[1]+r));return+((n=(yi(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round");function gi(t){if(!fi(t))return 0;t=li(t);let e=bi(t);return"0"===String(e)?0:e}function _i(t){if(!vi(t))return!1;return gi(t)>0}var mi={};var ji=mo;var xi=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t},Oi=No,Fi=function(t){return"function"==typeof t?t:ji},Si=xe;var ki=function(t,e){return(Si(t)?xi:Oi)(t,Fi(e))};!function(t){t.exports=ki}({get exports(){return mi},set exports(t){mi=t}});var Ai=a(mi),zi=V,Pi=xe,$i=Te;var Ei=function(t){return"string"==typeof t||!Pi(t)&&$i(t)&&"[object String]"==zi(t)},Ti=jo("length"),Ci=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Bi=function(t){return Ci.test(t)},Mi="\\ud800-\\udfff",Ni="["+Mi+"]",Li="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ii="\\ud83c[\\udffb-\\udfff]",Ui="[^"+Mi+"]",qi="(?:\\ud83c[\\udde6-\\uddff]){2}",Di="[\\ud800-\\udbff][\\udc00-\\udfff]",Ri="(?:"+Li+"|"+Ii+")"+"?",Vi="[\\ufe0e\\ufe0f]?",Wi=Vi+Ri+("(?:\\u200d(?:"+[Ui,qi,Di].join("|")+")"+Vi+Ri+")*"),Gi="(?:"+[Ui+Li+"?",Li,qi,Di,Ni].join("|")+")",Hi=RegExp(Ii+"(?="+Ii+")|"+Gi+Wi,"g");var Ji=Ti,Ki=Bi,Qi=function(t){for(var e=Hi.lastIndex=0;Hi.test(t);)++e;return e};var Xi=gr,Yi=Xr,Zi=jr,ta=Ei,ea=function(t){return Ki(t)?Qi(t):Ji(t)};var ra=function(t){if(null==t)return 0;if(Zi(t))return ta(t)?ea(t):t.length;var e=Yi(t);return"[object Map]"==e||"[object Set]"==e?t.size:Xi(t).length},na=u;var oa=function(t,e){return na(e,(function(e){return t[e]}))},ia=Sr;var aa=function(t){return null==t?[]:oa(t,ia(t))};function ua(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}function ca(t){return"[object Array]"===Object.prototype.toString.call(t)}function sa(t){return"[object Object]"===Object.prototype.toString.call(t)}function fa(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}var la={};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,n,i,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var u=new o(n,i||t,a),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],u]:t._events[c].push(u):(t._events[c]=u,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),u.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},u.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,a=new Array(i);o<i;o++)a[o]=n[o].fn;return a},u.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},u.prototype.emit=function(t,e,n,o,i,a){var u=r?r+t:t;if(!this._events[u])return!1;var c,s,f=this._events[u],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,o),!0;case 5:return f.fn.call(f.context,e,n,o,i),!0;case 6:return f.fn.call(f.context,e,n,o,i,a),!0}for(s=1,c=new Array(l-1);s<l;s++)c[s-1]=arguments[s];f.fn.apply(f.context,c)}else{var v,p=f.length;for(s=0;s<p;s++)switch(f[s].once&&this.removeListener(t,f[s].fn,void 0,!0),l){case 1:f[s].fn.call(f[s].context);break;case 2:f[s].fn.call(f[s].context,e);break;case 3:f[s].fn.call(f[s].context,e,n);break;case 4:f[s].fn.call(f[s].context,e,n,o);break;default:if(!c)for(v=1,c=new Array(l-1);v<l;v++)c[v-1]=arguments[v];f[s].fn.apply(f[s].context,c)}}return!0},u.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},u.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},u.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return a(this,i),this;var u=this._events[i];if(u.fn)u.fn!==e||o&&!u.once||n&&u.context!==n||a(this,i);else{for(var c=0,s=[],f=u.length;c<f;c++)(u[c].fn!==e||o&&!u[c].once||n&&u[c].context!==n)&&s.push(u[c]);s.length?this._events[i]=1===s.length?s[0]:s:a(this,i)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,t.exports=u}({get exports(){return la},set exports(t){la=t}});var va=la;function pa(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=0,r=[];var n;vi(n=t)&&gi(n)<0&&(t=0),t=gi(t);let o=new va;return o.get=function(){if(r.length>0){return e+=1,r.splice(0,1)[0]}return null},o.cb=function(){e-=1,e<0&&(e=0),r.length>0&&o.emit("message",r)},o.push=function(n){r.push(n),(t<=0||e<t)&&o.emit("message",r)},o.clear=function(){e=0,r=[]},o}function ha(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n={},o=!1,i=ua();if(!ca(t)&&!sa(t))return i.reject("rs is not an array or object"),i;let a=!1;if(sa(t)){a=!0;let e=[];Ai(t,((t,r)=>{e.push({k:r,v:t})})),t=e}let u=pa(r);return u.on("message",(function(r){if(o)return;let c,s=u.get();if(fa(e)){let t=s.key,r=s.value;a&&(t=s.value.k,r=s.value.v),c=e(r,t)}else c=s.value;c.then((t=>{n[s.key]=t})).catch((t=>{o=!0,u.clear(),i.reject(t)})).finally((()=>{u.cb(),ra(n)===t.length&&i.resolve(aa(n))}))})),Ai(t,((t,e)=>{u.push({key:e,value:t})})),i}var ya=V,da=Te;var wa=function(t){return!0===t||!1===t||da(t)&&"[object Boolean]"==ya(t)};function ba(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(sa(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!si(t)||""!==t)}(t)||!!function(t){return!!ca(t)&&0===t.length}(t))))}var ga=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i},_a=ai;var ma=function(t,e,r){var n=null==t?0:t.length;return n?(e=r||void 0===e?1:_a(e),ga(t,e<0?0:e,n)):[]};async function ja(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=oo(e,"headless");wa(n)||(n=!0);let o=oo(e,"viewport");sa(o)||(o={x:0,y:0,width:800,height:600});let i=oo(e,"actions");ca(i)||(i=[]);let a=oo(e,"waitsec");vi(a)||(a=5);let u={headless:n,slowMo:20},c=await r.launch(u),s=await c.newPage();async function f(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(r=gi(r),0===r){if(e=await s.$(t),ba(e))return console.log("page.$ get no result: "+t),null}else{let n=await s.$$(t);if(0===n.length)return console.log("page.$$ get no result: "+t),null;e=r<0?n[n.length+r]:n[r]}if(ba(e))return console.log("invalid ele: "+t),null;if(ba(e.boundingBox))return console.log("invalid ele.boundingBox: "+t),null;let n=await e.boundingBox();return n.cx=n.x+n.width/2,n.cy=n.y+n.height/2,n.ele=e,n}await s.goto(t),await s.setViewport(o),await s.waitFor(1e3*a),await function(t,e){let r=ua();if(!ca(t)&&!sa(t))return r.reject("rs is not an array or object"),r;let n=!1;if(sa(t)){n=!0;let e=[];Ai(t,((t,r)=>{e.push({k:r,v:t})})),t=e}fa(e)||(e=function(t){return t});let o=-1,i=[];return t.reduce((function(t,r){return t.then((function(t){i.push(t),o+=1;let a=o,u=r;return n&&(a=r.k,u=r.v),fa(e)?e(u,a):u}))}),Promise.resolve()).then((function(t){i.push(t),i=ma(i),r.resolve(i)})).catch((function(t){r.reject(t)})),r}(i,(async function(t){if("wait"===t.mode)await s.waitFor(t.time);else if("resize"===t.mode)await s.waitFor(300),await s.setViewport({x:0,y:0,width:t.width,height:t.height}),await s.waitFor(300);else if("move"===t.mode)await s.waitFor(300),await s.mouse.move(t.x1,t.y1),await s.waitFor(300);else if("elemove"===t.mode){await s.waitFor(300);let e=await f(t.selector,t.nth);e&&(await s.mouse.move(e.cx,e.cy),await s.waitFor(300))}else if("elehover"===t.mode)await s.waitFor(300),await s.hover(t.selector),await s.waitFor(300);else if("drag"===t.mode)await s.waitFor(300),await s.mouse.move(t.x1,t.y1),await s.mouse.down(),await s.waitFor(300),await s.mouse.move(t.x2,t.y2,{steps:50}),await s.waitFor(300),await s.mouse.up(),await s.waitFor(300);else if("eledrag"===t.mode){await s.waitFor(300);let e=await f(t.selector,t.nth);e&&(await s.mouse.move(e.cx,e.cy),await s.mouse.down(),await s.waitFor(300),await s.mouse.move(e.cx+t.shiftx,e.cy+t.shifty,{steps:50}),await s.waitFor(300),await s.mouse.up(),await s.waitFor(300))}else if("click"===t.mode)await s.waitFor(300),await s.mouse.move(t.x1,t.y1),await s.mouse.down(),await s.mouse.up(),await s.waitFor(300);else if("eleclick"===t.mode){await s.waitFor(300);let e=await f(t.selector,t.nth);e&&(await e.ele.click(),await s.waitFor(300))}else if("dbclick"===t.mode)await s.waitFor(300),await s.mouse.click(t.x1,t.y1,{clickCount:2}),await s.waitFor(300);else if("eledbclick"===t.mode){await s.waitFor(300);let e=await f(t.selector,t.nth);e&&(await e.ele.click({clickCount:2}),await s.waitFor(300))}else if("type"===t.mode)await s.waitFor(300),await s.keyboard.type(t.str,{delay:50}),t.noEnter||await s.keyboard.type(String.fromCharCode(13)),await s.waitFor(300);else if("eletype"===t.mode){await s.waitFor(300);let e=await f(t.selector,t.nth);e&&(await e.ele.click(),await s.waitFor(50),await s.keyboard.type(t.str,{delay:50}),t.noEnter||await s.keyboard.type(String.fromCharCode(13)),await s.waitFor(300))}else if("keypress"===t.mode){await s.waitFor(300);let e=gi(t.count);e<=0&&(e=1);for(let r=0;r<e;r++)await s.keyboard.press(t.key);await s.waitFor(300)}else if("elefocus"===t.mode){await s.waitFor(300);let e=await f(t.selector,t.nth);e&&(await e.ele.focus(),await s.waitFor(300))}else console.log("mode is unrecognized: "+t.mode)})),await s.waitFor(2e3);let l=await s.screenshot({encoding:"base64"});return await s.close(),await c.close(),l}async function xa(t){let e=Buffer.from(t,"base64");return(await n.read(e)).bitmap.data}async function Oa(t,e){return function(t,e){if(t.length!==e.length)return 0;let r=0,n=t.length;for(let n=0,o=t.length;n<o;n++)r+=Math.abs(t[n]-e[n])/255;return r=1-Math.pow(r/n,1/3),r}(await xa(t),await xa(e))}async function Fa(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.promises,o=await n.readdir(t);return""!==r&&(o=o.filter((function(t){return t.indexOf(r)>=0}))),o}function Sa(t){let r=e.readFileSync(t,"utf8");return o.parse(r)}t.build=async function(t,r,n,o){if(!e.existsSync(t))return void console.log("build: folder not exits: ",t);if(!K(r)&&!e.existsSync(r))return void console.log("build: folder not exits: ",r);e.existsSync(n)||e.mkdirSync(n);let i=await Fa(t,".html");K(o.htmlFilter)&&(i=o.htmlFilter(i));let a=Vo(i,(function(e){let o=e.replace(".html",""),i={name:o,actions:[],url:t+e,fn_png:n+o+".png",fn_base64:n+o+".base64"};return K(r)?i.actions=r(o):i.actions=Sa(r+o+".action.json"),i}));await async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=oo(r,"headless"),o=oo(r,"viewport"),i=oo(r,"waitsec"),a=10;return _i(r.num_web)&&(a=gi(r.num_web)),ha(t,(async function(t){console.log("expBuild: "+t.name);let r={headless:n,viewport:o,actions:t.actions,waitsec:i},a=await ja(t.url,r);t.fn_png&&e.writeFileSync(t.fn_png,a,"base64"),t.fn_base64&&e.writeFileSync(t.fn_base64,a,"utf8"),console.log("success: "+t.name)}),a).then((()=>{console.log("[32m%s[0m","expBuild success")})).catch((t=>{console.log("[31m%s[0m","expBuild error: "+t)}))}(a,o)},t.test=async function(t,r,n,o){if(!e.existsSync(t))return void console.log("test: folder not exits: ",t);if(!K(r)&&!e.existsSync(r))return void console.log("build: folder not exits: ",r);if(!e.existsSync(n))return void console.log("test: folder not exits: ",n);let i=await Fa(t,".html");K(o.htmlFilter)&&(i=o.htmlFilter(i));let a=Vo(i,(function(e){let o=e.replace(".html",""),i={name:o,actions:[],url:t+e,fn_base64:n+o+".base64"};return K(r)?i.actions=r(o):i.actions=Sa(r+o+".action.json"),i}));await async function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=oo(r,"headless"),o=oo(r,"viewport"),i=oo(r,"waitsec"),a=10;_i(r.num_web)&&(a=gi(r.num_web));let u=1;fi(r.ratio_similar)&&(u=li(r.ratio_similar));let c=!1;return ha(t,(async function(t){console.log("expTest: "+t.name);let r,a={headless:n,viewport:o,actions:t.actions,waitsec:i},s=await ja(t.url,a),f=e.readFileSync(t.fn_base64,"utf8");if(1===u)r=s===f;else{let t=await Oa(s,f);r=t>=u;let e=r?" >= ":"<";console.log(`ratio[${t}] ${e} ratio_similar[${u}]`)}return r?(c||console.log("success: "+t.name),t.name):(c||(console.log("error: "+t.name),e.writeFileSync(t.name+".err.png",s,"base64")),c=!0,Promise.reject(t.name))}),a).then((()=>{console.log("[32m%s[0m","expTest success")})).catch((t=>{console.log("[31m%s[0m","expTest error: "+t)}))}(a,o)}}));
//# sourceMappingURL=exp.umd.js.map
