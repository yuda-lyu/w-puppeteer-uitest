/*!
 * exp v1.0.29
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs"),require("bluebird"),require("puppeteer"),require("jimp"),require("json5")):"function"==typeof define&&define.amd?define(["exports","fs","bluebird","puppeteer","jimp","json5"],t):t((e=e||self).exp={},e.fs,e.bluebird,e.puppeteer,e.jimp,e.json5)}(this,(function(e,t,r,n,a,o){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a,o=o&&o.hasOwnProperty("default")?o.default:o;var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(e,t){return e(t={exports:{}},t.exports),t.exports}var s=c((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function s(e,t,r,n){var a=t&&t.prototype instanceof y?t:y,o=Object.create(a.prototype),i=new E(n||[]);return o._invoke=function(e,t,r){var n=l;return function(a,o){if(n===h)throw new Error("Generator is already running");if(n===v){if("throw"===a)throw o;return A()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var u=O(i,r);if(u){if(u===b)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=f(e,t,r);if("normal"===c.type){if(n=r.done?v:p,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=v,r.method="throw",r.arg=c.arg)}}}(e,r,i),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l="suspendedStart",p="suspendedYield",h="executing",v="completed",b={};function y(){}function d(){}function w(){}var x={};x[o]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(L([])));m&&m!==r&&n.call(m,o)&&(x=m);var _=w.prototype=y.prototype=Object.create(x);function j(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function k(e){var t;this._invoke=function(r,a){function o(){return new Promise((function(t,o){!function t(r,a,o,u){var c=f(e[r],e,a);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"===i(l)&&n.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,o,u)}),(function(e){t("throw",e,o,u)})):Promise.resolve(l).then((function(e){s.value=e,o(s)}),(function(e){return t("throw",e,o,u)}))}u(c.arg)}(r,a,t,o)}))}return t=t?t.then(o,o):o()}}function O(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method))return b;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var a=f(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,b;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(F,this),this.reset(!0)}function L(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:A}}function A(){return{value:t,done:!0}}return d.prototype=_.constructor=w,w.constructor=d,w[c]=d.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},j(k.prototype),k.prototype[u]=function(){return this},e.AsyncIterator=k,e.async=function(t,r,n,a){var o=new k(s(t,r,n,a));return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},j(_),_[c]="Generator",_[o]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return u.type="throw",u.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;S(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:L(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));var f=function(e,t){for(var r=-1,n=null==e?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a};var l=function(){this.__data__=[],this.size=0};var p=function(e,t){return e===t||e!=e&&t!=t};var h=function(e,t){for(var r=e.length;r--;)if(p(e[r][0],t))return r;return-1},v=Array.prototype.splice;var b=function(e){var t=this.__data__,r=h(t,e);return!(r<0)&&(r==t.length-1?t.pop():v.call(t,r,1),--this.size,!0)};var y=function(e){var t=this.__data__,r=h(t,e);return r<0?void 0:t[r][1]};var d=function(e){return h(this.__data__,e)>-1};var w=function(e,t){var r=this.__data__,n=h(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function x(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}x.prototype.clear=l,x.prototype.delete=b,x.prototype.get=y,x.prototype.has=d,x.prototype.set=w;var g=x;var m=function(){this.__data__=new g,this.size=0};var _=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var j=function(e){return this.__data__.get(e)};var k=function(e){return this.__data__.has(e)},O="object"==i(u)&&u&&u.Object===Object&&u,F="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,S=O||F||Function("return this")(),E=S.Symbol,L=Object.prototype,A=L.hasOwnProperty,P=L.toString,z=E?E.toStringTag:void 0;var $=function(e){var t=A.call(e,z),r=e[z];try{e[z]=void 0;var n=!0}catch(e){}var a=P.call(e);return n&&(t?e[z]=r:delete e[z]),a},T=Object.prototype.toString;var N=function(e){return T.call(e)},B="[object Null]",M="[object Undefined]",C=E?E.toStringTag:void 0;var I=function(e){return null==e?void 0===e?M:B:C&&C in Object(e)?$(e):N(e)};var G=function(e){var t=i(e);return null!=e&&("object"==t||"function"==t)},q="[object AsyncFunction]",D="[object Function]",U="[object GeneratorFunction]",V="[object Proxy]";var R,W=function(e){if(!G(e))return!1;var t=I(e);return t==D||t==U||t==q||t==V},Y=S["__core-js_shared__"],H=(R=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"";var J=function(e){return!!H&&H in e},K=Function.prototype.toString;var Q=function(e){if(null!=e){try{return K.call(e)}catch(e){}try{return e+""}catch(e){}}return""},X=/^\[object .+?Constructor\]$/,Z=Function.prototype,ee=Object.prototype,te=Z.toString,re=ee.hasOwnProperty,ne=RegExp("^"+te.call(re).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ae=function(e){return!(!G(e)||J(e))&&(W(e)?ne:X).test(Q(e))};var oe=function(e,t){return null==e?void 0:e[t]};var ie=function(e,t){var r=oe(e,t);return ae(r)?r:void 0},ue=ie(S,"Map"),ce=ie(Object,"create");var se=function(){this.__data__=ce?ce(null):{},this.size=0};var fe=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},le="__lodash_hash_undefined__",pe=Object.prototype.hasOwnProperty;var he=function(e){var t=this.__data__;if(ce){var r=t[e];return r===le?void 0:r}return pe.call(t,e)?t[e]:void 0},ve=Object.prototype.hasOwnProperty;var be=function(e){var t=this.__data__;return ce?void 0!==t[e]:ve.call(t,e)},ye="__lodash_hash_undefined__";var de=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ce&&void 0===t?ye:t,this};function we(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}we.prototype.clear=se,we.prototype.delete=fe,we.prototype.get=he,we.prototype.has=be,we.prototype.set=de;var xe=we;var ge=function(){this.size=0,this.__data__={hash:new xe,map:new(ue||g),string:new xe}};var me=function(e){var t=i(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var _e=function(e,t){var r=e.__data__;return me(t)?r["string"==typeof t?"string":"hash"]:r.map};var je=function(e){var t=_e(this,e).delete(e);return this.size-=t?1:0,t};var ke=function(e){return _e(this,e).get(e)};var Oe=function(e){return _e(this,e).has(e)};var Fe=function(e,t){var r=_e(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Se(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Se.prototype.clear=ge,Se.prototype.delete=je,Se.prototype.get=ke,Se.prototype.has=Oe,Se.prototype.set=Fe;var Ee=Se,Le=200;var Ae=function(e,t){var r=this.__data__;if(r instanceof g){var n=r.__data__;if(!ue||n.length<Le-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ee(n)}return r.set(e,t),this.size=r.size,this};function Pe(e){var t=this.__data__=new g(e);this.size=t.size}Pe.prototype.clear=m,Pe.prototype.delete=_,Pe.prototype.get=j,Pe.prototype.has=k,Pe.prototype.set=Ae;var ze=Pe,$e="__lodash_hash_undefined__";var Te=function(e){return this.__data__.set(e,$e),this};var Ne=function(e){return this.__data__.has(e)};function Be(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Ee;++t<r;)this.add(e[t])}Be.prototype.add=Be.prototype.push=Te,Be.prototype.has=Ne;var Me=Be;var Ce=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var Ie=function(e,t){return e.has(t)},Ge=1,qe=2;var De=function(e,t,r,n,a,o){var i=r&Ge,u=e.length,c=t.length;if(u!=c&&!(i&&c>u))return!1;var s=o.get(e);if(s&&o.get(t))return s==t;var f=-1,l=!0,p=r&qe?new Me:void 0;for(o.set(e,t),o.set(t,e);++f<u;){var h=e[f],v=t[f];if(n)var b=i?n(v,h,f,t,e,o):n(h,v,f,e,t,o);if(void 0!==b){if(b)continue;l=!1;break}if(p){if(!Ce(t,(function(e,t){if(!Ie(p,t)&&(h===e||a(h,e,r,n,o)))return p.push(t)}))){l=!1;break}}else if(h!==v&&!a(h,v,r,n,o)){l=!1;break}}return o.delete(e),o.delete(t),l},Ue=S.Uint8Array;var Ve=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var Re=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},We=1,Ye=2,He="[object Boolean]",Je="[object Date]",Ke="[object Error]",Qe="[object Map]",Xe="[object Number]",Ze="[object RegExp]",et="[object Set]",tt="[object String]",rt="[object Symbol]",nt="[object ArrayBuffer]",at="[object DataView]",ot=E?E.prototype:void 0,it=ot?ot.valueOf:void 0;var ut=function(e,t,r,n,a,o,i){switch(r){case at:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case nt:return!(e.byteLength!=t.byteLength||!o(new Ue(e),new Ue(t)));case He:case Je:case Xe:return p(+e,+t);case Ke:return e.name==t.name&&e.message==t.message;case Ze:case tt:return e==t+"";case Qe:var u=Ve;case et:var c=n&We;if(u||(u=Re),e.size!=t.size&&!c)return!1;var s=i.get(e);if(s)return s==t;n|=Ye,i.set(e,t);var f=De(u(e),u(t),n,a,o,i);return i.delete(e),f;case rt:if(it)return it.call(e)==it.call(t)}return!1};var ct=function(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e},st=Array.isArray;var ft=function(e,t,r){var n=t(e);return st(e)?n:ct(n,r(e))};var lt=function(e,t){for(var r=-1,n=null==e?0:e.length,a=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[a++]=i)}return o};var pt=function(){return[]},ht=Object.prototype.propertyIsEnumerable,vt=Object.getOwnPropertySymbols,bt=vt?function(e){return null==e?[]:(e=Object(e),lt(vt(e),(function(t){return ht.call(e,t)})))}:pt;var yt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var dt=function(e){return null!=e&&"object"==i(e)},wt="[object Arguments]";var xt=function(e){return dt(e)&&I(e)==wt},gt=Object.prototype,mt=gt.hasOwnProperty,_t=gt.propertyIsEnumerable,jt=xt(function(){return arguments}())?xt:function(e){return dt(e)&&mt.call(e,"callee")&&!_t.call(e,"callee")};var kt=function(){return!1},Ot=c((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r?S.Buffer:void 0,o=(a?a.isBuffer:void 0)||kt;e.exports=o})),Ft=9007199254740991,St=/^(?:0|[1-9]\d*)$/;var Et=function(e,t){var r=i(e);return!!(t=null==t?Ft:t)&&("number"==r||"symbol"!=r&&St.test(e))&&e>-1&&e%1==0&&e<t},Lt=9007199254740991;var At=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Lt},Pt={};Pt["[object Float32Array]"]=Pt["[object Float64Array]"]=Pt["[object Int8Array]"]=Pt["[object Int16Array]"]=Pt["[object Int32Array]"]=Pt["[object Uint8Array]"]=Pt["[object Uint8ClampedArray]"]=Pt["[object Uint16Array]"]=Pt["[object Uint32Array]"]=!0,Pt["[object Arguments]"]=Pt["[object Array]"]=Pt["[object ArrayBuffer]"]=Pt["[object Boolean]"]=Pt["[object DataView]"]=Pt["[object Date]"]=Pt["[object Error]"]=Pt["[object Function]"]=Pt["[object Map]"]=Pt["[object Number]"]=Pt["[object Object]"]=Pt["[object RegExp]"]=Pt["[object Set]"]=Pt["[object String]"]=Pt["[object WeakMap]"]=!1;var zt=function(e){return dt(e)&&At(e.length)&&!!Pt[I(e)]};var $t=function(e){return function(t){return e(t)}},Tt=c((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,a=n&&n.exports===r&&O.process,o=function(){try{var e=n&&n.require&&n.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o})),Nt=Tt&&Tt.isTypedArray,Bt=Nt?$t(Nt):zt,Mt=Object.prototype.hasOwnProperty;var Ct=function(e,t){var r=st(e),n=!r&&jt(e),a=!r&&!n&&Ot(e),o=!r&&!n&&!a&&Bt(e),i=r||n||a||o,u=i?yt(e.length,String):[],c=u.length;for(var s in e)!t&&!Mt.call(e,s)||i&&("length"==s||a&&("offset"==s||"parent"==s)||o&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Et(s,c))||u.push(s);return u},It=Object.prototype;var Gt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||It)};var qt=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Dt=Object.prototype.hasOwnProperty;var Ut=function(e){if(!Gt(e))return qt(e);var t=[];for(var r in Object(e))Dt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Vt=function(e){return null!=e&&At(e.length)&&!W(e)};var Rt=function(e){return Vt(e)?Ct(e):Ut(e)};var Wt=function(e){return ft(e,Rt,bt)},Yt=1,Ht=Object.prototype.hasOwnProperty;var Jt=function(e,t,r,n,a,o){var i=r&Yt,u=Wt(e),c=u.length;if(c!=Wt(t).length&&!i)return!1;for(var s=c;s--;){var f=u[s];if(!(i?f in t:Ht.call(t,f)))return!1}var l=o.get(e);if(l&&o.get(t))return l==t;var p=!0;o.set(e,t),o.set(t,e);for(var h=i;++s<c;){var v=e[f=u[s]],b=t[f];if(n)var y=i?n(b,v,f,t,e,o):n(v,b,f,e,t,o);if(!(void 0===y?v===b||a(v,b,r,n,o):y)){p=!1;break}h||(h="constructor"==f)}if(p&&!h){var d=e.constructor,w=t.constructor;d!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof d&&d instanceof d&&"function"==typeof w&&w instanceof w)&&(p=!1)}return o.delete(e),o.delete(t),p},Kt=ie(S,"DataView"),Qt=ie(S,"Promise"),Xt=ie(S,"Set"),Zt=ie(S,"WeakMap"),er=Q(Kt),tr=Q(ue),rr=Q(Qt),nr=Q(Xt),ar=Q(Zt),or=I;(Kt&&"[object DataView]"!=or(new Kt(new ArrayBuffer(1)))||ue&&"[object Map]"!=or(new ue)||Qt&&"[object Promise]"!=or(Qt.resolve())||Xt&&"[object Set]"!=or(new Xt)||Zt&&"[object WeakMap]"!=or(new Zt))&&(or=function(e){var t=I(e),r="[object Object]"==t?e.constructor:void 0,n=r?Q(r):"";if(n)switch(n){case er:return"[object DataView]";case tr:return"[object Map]";case rr:return"[object Promise]";case nr:return"[object Set]";case ar:return"[object WeakMap]"}return t});var ir=or,ur=1,cr="[object Arguments]",sr="[object Array]",fr="[object Object]",lr=Object.prototype.hasOwnProperty;var pr=function(e,t,r,n,a,o){var i=st(e),u=st(t),c=i?sr:ir(e),s=u?sr:ir(t),f=(c=c==cr?fr:c)==fr,l=(s=s==cr?fr:s)==fr,p=c==s;if(p&&Ot(e)){if(!Ot(t))return!1;i=!0,f=!1}if(p&&!f)return o||(o=new ze),i||Bt(e)?De(e,t,r,n,a,o):ut(e,t,c,r,n,a,o);if(!(r&ur)){var h=f&&lr.call(e,"__wrapped__"),v=l&&lr.call(t,"__wrapped__");if(h||v){var b=h?e.value():e,y=v?t.value():t;return o||(o=new ze),a(b,y,r,n,o)}}return!!p&&(o||(o=new ze),Jt(e,t,r,n,a,o))};var hr=function e(t,r,n,a,o){return t===r||(null==t||null==r||!dt(t)&&!dt(r)?t!=t&&r!=r:pr(t,r,n,a,e,o))},vr=1,br=2;var yr=function(e,t,r,n){var a=r.length,o=a,i=!n;if(null==e)return!o;for(e=Object(e);a--;){var u=r[a];if(i&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++a<o;){var c=(u=r[a])[0],s=e[c],f=u[1];if(i&&u[2]){if(void 0===s&&!(c in e))return!1}else{var l=new ze;if(n)var p=n(s,f,c,e,t,l);if(!(void 0===p?hr(f,s,vr|br,n,l):p))return!1}}return!0};var dr=function(e){return e==e&&!G(e)};var wr=function(e){for(var t=Rt(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,dr(a)]}return t};var xr=function(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}};var gr=function(e){var t=wr(e);return 1==t.length&&t[0][2]?xr(t[0][0],t[0][1]):function(r){return r===e||yr(r,e,t)}},mr="[object Symbol]";var _r=function(e){return"symbol"==i(e)||dt(e)&&I(e)==mr},jr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kr=/^\w*$/;var Or=function(e,t){if(st(e))return!1;var r=i(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!_r(e))||(kr.test(e)||!jr.test(e)||null!=t&&e in Object(t))},Fr="Expected a function";function Sr(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(Fr);var r=function r(){var n=arguments,a=t?t.apply(this,n):n[0],o=r.cache;if(o.has(a))return o.get(a);var i=e.apply(this,n);return r.cache=o.set(a,i)||o,i};return r.cache=new(Sr.Cache||Ee),r}Sr.Cache=Ee;var Er=Sr,Lr=500;var Ar=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pr=/\\(\\)?/g,zr=function(e){var t=Er(e,(function(e){return r.size===Lr&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ar,(function(e,r,n,a){t.push(n?a.replace(Pr,"$1"):r||e)})),t})),$r=1/0,Tr=E?E.prototype:void 0,Nr=Tr?Tr.toString:void 0;var Br=function e(t){if("string"==typeof t)return t;if(st(t))return f(t,e)+"";if(_r(t))return Nr?Nr.call(t):"";var r=t+"";return"0"==r&&1/t==-$r?"-0":r};var Mr=function(e){return null==e?"":Br(e)};var Cr=function(e,t){return st(e)?e:Or(e,t)?[e]:zr(Mr(e))},Ir=1/0;var Gr=function(e){if("string"==typeof e||_r(e))return e;var t=e+"";return"0"==t&&1/e==-Ir?"-0":t};var qr=function(e,t){for(var r=0,n=(t=Cr(t,e)).length;null!=e&&r<n;)e=e[Gr(t[r++])];return r&&r==n?e:void 0};var Dr=function(e,t,r){var n=null==e?void 0:qr(e,t);return void 0===n?r:n};var Ur=function(e,t){return null!=e&&t in Object(e)};var Vr=function(e,t,r){for(var n=-1,a=(t=Cr(t,e)).length,o=!1;++n<a;){var i=Gr(t[n]);if(!(o=null!=e&&r(e,i)))break;e=e[i]}return o||++n!=a?o:!!(a=null==e?0:e.length)&&At(a)&&Et(i,a)&&(st(e)||jt(e))};var Rr=function(e,t){return null!=e&&Vr(e,t,Ur)},Wr=1,Yr=2;var Hr=function(e,t){return Or(e)&&dr(t)?xr(Gr(e),t):function(r){var n=Dr(r,e);return void 0===n&&n===t?Rr(r,e):hr(t,n,Wr|Yr)}};var Jr=function(e){return e};var Kr=function(e){return function(t){return null==t?void 0:t[e]}};var Qr=function(e){return function(t){return qr(t,e)}};var Xr=function(e){return Or(e)?Kr(Gr(e)):Qr(e)};var Zr=function(e){return"function"==typeof e?e:null==e?Jr:"object"==i(e)?st(e)?Hr(e[0],e[1]):gr(e):Xr(e)};var en=function(e){return function(t,r,n){for(var a=-1,o=Object(t),i=n(t),u=i.length;u--;){var c=i[e?u:++a];if(!1===r(o[c],c,o))break}return t}}();var tn=function(e,t){return function(r,n){if(null==r)return r;if(!Vt(r))return e(r,n);for(var a=r.length,o=t?a:-1,i=Object(r);(t?o--:++o<a)&&!1!==n(i[o],o,i););return r}}((function(e,t){return e&&en(e,t,Rt)}));var rn=function(e,t){var r=-1,n=Vt(e)?Array(e.length):[];return tn(e,(function(e,a,o){n[++r]=t(e,a,o)})),n};var nn=function(e,t){return(st(e)?f:rn)(e,Zr(t))},an=NaN,on=/^\s+|\s+$/g,un=/^[-+]0x[0-9a-f]+$/i,cn=/^0b[01]+$/i,sn=/^0o[0-7]+$/i,fn=parseInt;var ln=function(e){if("number"==typeof e)return e;if(_r(e))return an;if(G(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=G(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(on,"");var r=cn.test(e);return r||sn.test(e)?fn(e.slice(2),r?2:8):un.test(e)?an:+e},pn=1/0,hn=17976931348623157e292;var vn=function(e){return e?(e=ln(e))===pn||e===-pn?(e<0?-1:1)*hn:e==e?e:0:0===e?e:0};var bn=function(e){var t=vn(e),r=t%1;return t==t?r?t-r:t:0};var yn=function(e){return"number"==typeof e&&e==bn(e)};function dn(e){return"[object String]"===Object.prototype.toString.call(e)}function wn(e){var t=!1;return!function(e){return!(!dn(e)||""===e)}(e)?function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)&&(t=!0):t=!isNaN(Number(e)),t}function xn(e){return wn(e)?vn(e):0}function gn(e){return!!wn(e)&&(e=xn(e),yn(e))}var mn=S.isFinite,_n=Math.min;var jn=function(e){var t=Math[e];return function(e,r){if(e=ln(e),(r=null==r?0:_n(bn(r),292))&&mn(e)){var n=(Mr(e)+"e").split("e"),a=t(n[0]+"e"+(+n[1]+r));return+((n=(Mr(a)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");function kn(e){if(!wn(e))return 0;e=xn(e);var t=jn(e);return"0"===String(t)?0:t}function On(e){return!!gn(e)&&kn(e)>0}function Fn(e){return"[object Object]"===Object.prototype.toString.call(e)}function Sn(e){return"[object Array]"===Object.prototype.toString.call(e)}var En="[object Boolean]";var Ln=function(e){return!0===e||!1===e||dt(e)&&I(e)==En};function An(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(Fn(e)){for(var t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!dn(e)||""!==e)}(e)||!!function(e){return!!Sn(e)&&0===e.length}(e))))}function Pn(e){var t,a,o,i,u,c,f,l,p,h,v=arguments;return s.async((function(b){for(;;)switch(b.prev=b.next){case 0:return p=function(e){var t,r,n,a,o=arguments;return s.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(0!==(t=kn(t=o.length>1&&void 0!==o[1]?o[1]:0))){i.next=11;break}return i.next=5,s.awrap(l.$(e));case 5:if(!An(r=i.sent)){i.next=9;break}return console.log("page.$ get no result: "+e),i.abrupt("return",null);case 9:i.next=18;break;case 11:return i.next=13,s.awrap(l.$$(e));case 13:if(0!==(n=i.sent).length){i.next=17;break}return console.log("page.$$ get no result: "+e),i.abrupt("return",null);case 17:r=t<0?n[n.length+t]:n[t];case 18:if(!An(r)){i.next=21;break}return console.log("invalid ele: "+e),i.abrupt("return",null);case 21:if(!An(r.boundingBox)){i.next=24;break}return console.log("invalid ele.boundingBox: "+e),i.abrupt("return",null);case 24:return i.next=26,s.awrap(r.boundingBox());case 26:return(a=i.sent).cx=a.x+a.width/2,a.cy=a.y+a.height/2,a.ele=r,i.abrupt("return",a);case 31:case"end":return i.stop()}}))},t=v.length>1&&void 0!==v[1]?v[1]:{},a=Dr(t,"headless"),Ln(a)||(a=!0),Fn(o=Dr(t,"viewport"))||(o={x:0,y:0,width:800,height:600}),Sn(i=Dr(t,"actions"))||(i=[]),gn(u=Dr(t,"waitsec"))||(u=5),c={headless:a,slowMo:20},b.next=13,s.awrap(n.launch(c));case 13:return f=b.sent,b.next=16,s.awrap(f.newPage());case 16:return l=b.sent,b.next=19,s.awrap(l.goto(e));case 19:return b.next=21,s.awrap(l.setViewport(o));case 21:return b.next=23,s.awrap(l.waitFor(1e3*u));case 23:return b.next=25,s.awrap(r.mapSeries(i,(function(e){var t,r,n,a,o,i,u,c;return s.async((function(f){for(;;)switch(f.prev=f.next){case 0:if("wait"!==e.mode){f.next=5;break}return f.next=3,s.awrap(l.waitFor(e.time));case 3:f.next=197;break;case 5:if("resize"!==e.mode){f.next=14;break}return f.next=8,s.awrap(l.waitFor(300));case 8:return f.next=10,s.awrap(l.setViewport({x:0,y:0,width:e.width,height:e.height}));case 10:return f.next=12,s.awrap(l.waitFor(300));case 12:f.next=197;break;case 14:if("move"!==e.mode){f.next=23;break}return f.next=17,s.awrap(l.waitFor(300));case 17:return f.next=19,s.awrap(l.mouse.move(e.x1,e.y1));case 19:return f.next=21,s.awrap(l.waitFor(300));case 21:f.next=197;break;case 23:if("elemove"!==e.mode){f.next=36;break}return f.next=26,s.awrap(l.waitFor(300));case 26:return f.next=28,s.awrap(p(e.selector,e.nth));case 28:if(!(t=f.sent)){f.next=34;break}return f.next=32,s.awrap(l.mouse.move(t.cx,t.cy));case 32:return f.next=34,s.awrap(l.waitFor(300));case 34:f.next=197;break;case 36:if("elehover"!==e.mode){f.next=45;break}return f.next=39,s.awrap(l.waitFor(300));case 39:return f.next=41,s.awrap(l.hover(e.selector));case 41:return f.next=43,s.awrap(l.waitFor(300));case 43:f.next=197;break;case 45:if("drag"!==e.mode){f.next=64;break}return f.next=48,s.awrap(l.waitFor(300));case 48:return f.next=50,s.awrap(l.mouse.move(e.x1,e.y1));case 50:return f.next=52,s.awrap(l.mouse.down());case 52:return f.next=54,s.awrap(l.waitFor(300));case 54:return f.next=56,s.awrap(l.mouse.move(e.x2,e.y2,{steps:50}));case 56:return f.next=58,s.awrap(l.waitFor(300));case 58:return f.next=60,s.awrap(l.mouse.up());case 60:return f.next=62,s.awrap(l.waitFor(300));case 62:f.next=197;break;case 64:if("eledrag"!==e.mode){f.next=87;break}return f.next=67,s.awrap(l.waitFor(300));case 67:return f.next=69,s.awrap(p(e.selector,e.nth));case 69:if(!(r=f.sent)){f.next=85;break}return f.next=73,s.awrap(l.mouse.move(r.cx,r.cy));case 73:return f.next=75,s.awrap(l.mouse.down());case 75:return f.next=77,s.awrap(l.waitFor(300));case 77:return f.next=79,s.awrap(l.mouse.move(r.cx+e.shiftx,r.cy+e.shifty,{steps:50}));case 79:return f.next=81,s.awrap(l.waitFor(300));case 81:return f.next=83,s.awrap(l.mouse.up());case 83:return f.next=85,s.awrap(l.waitFor(300));case 85:f.next=197;break;case 87:if("click"!==e.mode){f.next=100;break}return f.next=90,s.awrap(l.waitFor(300));case 90:return f.next=92,s.awrap(l.mouse.move(e.x1,e.y1));case 92:return f.next=94,s.awrap(l.mouse.down());case 94:return f.next=96,s.awrap(l.mouse.up());case 96:return f.next=98,s.awrap(l.waitFor(300));case 98:f.next=197;break;case 100:if("eleclick"!==e.mode){f.next=113;break}return f.next=103,s.awrap(l.waitFor(300));case 103:return f.next=105,s.awrap(p(e.selector,e.nth));case 105:if(!(n=f.sent)){f.next=111;break}return f.next=109,s.awrap(n.ele.click());case 109:return f.next=111,s.awrap(l.waitFor(300));case 111:f.next=197;break;case 113:if("dbclick"!==e.mode){f.next=122;break}return f.next=116,s.awrap(l.waitFor(300));case 116:return f.next=118,s.awrap(l.mouse.click(e.x1,e.y1,{clickCount:2}));case 118:return f.next=120,s.awrap(l.waitFor(300));case 120:f.next=197;break;case 122:if("eledbclick"!==e.mode){f.next=135;break}return f.next=125,s.awrap(l.waitFor(300));case 125:return f.next=127,s.awrap(p(e.selector,e.nth));case 127:if(!(a=f.sent)){f.next=133;break}return f.next=131,s.awrap(a.ele.click({clickCount:2}));case 131:return f.next=133,s.awrap(l.waitFor(300));case 133:f.next=197;break;case 135:if("type"!==e.mode){f.next=147;break}return f.next=138,s.awrap(l.waitFor(300));case 138:return f.next=140,s.awrap(l.keyboard.type(e.str,{delay:50}));case 140:if(e.noEnter){f.next=143;break}return f.next=143,s.awrap(l.keyboard.type(String.fromCharCode(13)));case 143:return f.next=145,s.awrap(l.waitFor(300));case 145:f.next=197;break;case 147:if("eletype"!==e.mode){f.next=167;break}return f.next=150,s.awrap(l.waitFor(300));case 150:return f.next=152,s.awrap(p(e.selector,e.nth));case 152:if(!(o=f.sent)){f.next=165;break}return f.next=156,s.awrap(o.ele.click());case 156:return f.next=158,s.awrap(l.waitFor(50));case 158:return f.next=160,s.awrap(l.keyboard.type(e.str,{delay:50}));case 160:if(e.noEnter){f.next=163;break}return f.next=163,s.awrap(l.keyboard.type(String.fromCharCode(13)));case 163:return f.next=165,s.awrap(l.waitFor(300));case 165:f.next=197;break;case 167:if("keypress"!==e.mode){f.next=183;break}return f.next=170,s.awrap(l.waitFor(300));case 170:(i=kn(e.count))<=0&&(i=1),u=0;case 173:if(!(u<i)){f.next=179;break}return f.next=176,s.awrap(l.keyboard.press(e.key));case 176:u++,f.next=173;break;case 179:return f.next=181,s.awrap(l.waitFor(300));case 181:f.next=197;break;case 183:if("elefocus"!==e.mode){f.next=196;break}return f.next=186,s.awrap(l.waitFor(300));case 186:return f.next=188,s.awrap(p(e.selector,e.nth));case 188:if(!(c=f.sent)){f.next=194;break}return f.next=192,s.awrap(c.ele.focus());case 192:return f.next=194,s.awrap(l.waitFor(300));case 194:f.next=197;break;case 196:console.log("mode is unrecognized: "+e.mode);case 197:case"end":return f.stop()}}))})));case 25:return b.next=27,s.awrap(l.waitFor(2e3));case 27:return b.next=29,s.awrap(l.screenshot({encoding:"base64"}));case 29:return h=b.sent,b.next=32,s.awrap(l.close());case 32:return b.next=34,s.awrap(f.close());case 34:return b.abrupt("return",h);case 35:case"end":return b.stop()}}))}function zn(e){var n,a,o,i,u,c=arguments;return s.async((function(f){for(;;)switch(f.prev=f.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},a=Dr(n,"headless"),o=Dr(n,"viewport"),i=Dr(n,"waitsec"),u=10,On(n.num_web)&&(u=kn(n.num_web)),f.abrupt("return",r.map(e,(function(e){var r,n;return s.async((function(u){for(;;)switch(u.prev=u.next){case 0:return console.log("expBuild: "+e.name),r={headless:a,viewport:o,actions:e.actions,waitsec:i},u.next=4,s.awrap(Pn(e.url,r));case 4:n=u.sent,e.fn_png&&t.writeFileSync(e.fn_png,n,"base64"),e.fn_base64&&t.writeFileSync(e.fn_base64,n,"utf8"),console.log("success: "+e.name);case 8:case"end":return u.stop()}}))}),{concurrency:u}).then((function(){console.log("[32m%s[0m","expBuild success")})).catch((function(e){console.log("[31m%s[0m","expBuild error: "+e)})));case 7:case"end":return f.stop()}}))}function $n(e,t){if(e.length!==t.length)return 0;for(var r=0,n=e.length,a=0,o=e.length;a<o;a++){r+=Math.abs(e[a]-t[a])/255}return r=1-Math.pow(r/n,1/3)}function Tn(e){var t,r;return s.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=Buffer.from(e,"base64"),n.next=3,s.awrap(a.read(t));case 3:return r=n.sent,n.abrupt("return",r.bitmap.data);case 5:case"end":return n.stop()}}))}function Nn(e,t){var r,n;return s.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.awrap(Tn(e));case 2:return r=a.sent,a.next=5,s.awrap(Tn(t));case 5:return n=a.sent,a.abrupt("return",$n(r,n));case 7:case"end":return a.stop()}}))}function Bn(e){var n,a,o,i,u,c,f,l=arguments;return s.async((function(p){for(;;)switch(p.prev=p.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},a=Dr(n,"headless"),o=Dr(n,"viewport"),i=Dr(n,"waitsec"),u=10,On(n.num_web)&&(u=kn(n.num_web)),c=1,wn(n.ratio_similar)&&(c=xn(n.ratio_similar)),f=!1,p.abrupt("return",r.map(e,(function(e){var r,n,u,l,p,h;return s.async((function(v){for(;;)switch(v.prev=v.next){case 0:return console.log("expTest: "+e.name),r={headless:a,viewport:o,actions:e.actions,waitsec:i},v.next=4,s.awrap(Pn(e.url,r));case 4:if(n=v.sent,u=t.readFileSync(e.fn_base64,"utf8"),1!==c){v.next=10;break}l=n===u,v.next=16;break;case 10:return v.next=12,s.awrap(Nn(n,u));case 12:p=v.sent,h=(l=p>=c)?" >= ":"<",console.log("ratio[".concat(p,"] ").concat(h," ratio_similar[").concat(c,"]"));case 16:if(!l){v.next=20;break}f||console.log("success: "+e.name),v.next=23;break;case 20:return f||(console.log("error: "+e.name),t.writeFileSync(e.name+".err.png",n,"base64")),f=!0,v.abrupt("return",Promise.reject(e.name));case 23:return v.abrupt("return",e.name);case 24:case"end":return v.stop()}}))}),{concurrency:u}).then((function(){console.log("[32m%s[0m","expTest success")})).catch((function(e){console.log("[31m%s[0m","expTest error: "+e)})));case 10:case"end":return p.stop()}}))}function Mn(e){var r,n,a,o=arguments;return s.async((function(i){for(;;)switch(i.prev=i.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"",n=t.promises,i.next=4,s.awrap(n.readdir(e));case 4:return a=i.sent,""!==r&&(a=a.filter((function(e){return e.indexOf(r)>=0}))),i.abrupt("return",a);case 7:case"end":return i.stop()}}))}function Cn(e){var r=t.readFileSync(e,"utf8");return o.parse(r)}e.build=function(e,r,n,a){var o,i;return s.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(t.existsSync(e)){u.next=3;break}return console.log("build: folder not exits: ",e),u.abrupt("return");case 3:if(W(r)){u.next=7;break}if(t.existsSync(r)){u.next=7;break}return console.log("build: folder not exits: ",r),u.abrupt("return");case 7:return t.existsSync(n)||t.mkdirSync(n),u.next=10,s.awrap(Mn(e,".html"));case 10:return o=u.sent,W(a.htmlFilter)&&(o=a.htmlFilter(o)),i=nn(o,(function(t){var a=t.replace(".html",""),o={name:a,actions:[],url:e+t,fn_png:n+a+".png",fn_base64:n+a+".base64"};return W(r)?o.actions=r(a):o.actions=Cn(r+a+".action.json"),o})),u.next=15,s.awrap(zn(i,a));case 15:case"end":return u.stop()}}))},e.test=function(e,r,n,a){var o,i;return s.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(t.existsSync(e)){u.next=3;break}return console.log("test: folder not exits: ",e),u.abrupt("return");case 3:if(W(r)){u.next=7;break}if(t.existsSync(r)){u.next=7;break}return console.log("build: folder not exits: ",r),u.abrupt("return");case 7:if(t.existsSync(n)){u.next=10;break}return console.log("test: folder not exits: ",n),u.abrupt("return");case 10:return u.next=12,s.awrap(Mn(e,".html"));case 12:return o=u.sent,W(a.htmlFilter)&&(o=a.htmlFilter(o)),i=nn(o,(function(t){var a=t.replace(".html",""),o={name:a,actions:[],url:e+t,fn_base64:n+a+".base64"};return W(r)?o.actions=r(a):o.actions=Cn(r+a+".action.json"),o})),u.next=17,s.awrap(Bn(i,a));case 17:case"end":return u.stop()}}))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=exp.umd.js.map
