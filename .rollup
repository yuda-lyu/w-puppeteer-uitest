import commonjs from 'rollup-plugin-commonjs'
import resolve from 'rollup-plugin-node-resolve'
import postcss from 'rollup-plugin-postcss'
import babel from 'rollup-plugin-babel'
//import buble from 'rollup-plugin-buble'
import minify from 'rollup-plugin-babel-minify'
import fs from 'fs'
 
 
let pkg=JSON.parse(fs.readFileSync('package.json', 'utf8'))

let optBabel={
      runtimeHelpers: true,
      exclude: 'node_modules/**',
      include: 'node_modules/wsemi/**', //need compile wsemi
      presets: [
        [
          "@babel/preset-env",
          {
            useBuiltIns: 'entry', //entry usage, usage is not stable
            corejs: 3,
          }
        ]
      ],
      plugins: [
        //"@babel/plugin-proposal-export-default-from",
        //"@babel/plugin-transform-runtime"
      ]
    }

export default [
  {
    input: 'src/saveB64.mjs',
    output: {
      banner: '/*!\n * w-puppeteer-uitest v' + pkg.version + '\n * (c) 2018-2019 ' + pkg.author + '\n * Released under the MIT License.\n */',
      globals: {
        'fs': 'fs',
      },
      format: 'umd',
      name: 'w-puppeteer-uitest',
      file: 'dist/w-puppeteer-uitest-saveB64.umd.js',
      sourcemap: true
    },
    external: [
        'fs',
    ], 
    plugins: [
      commonjs(),
      resolve({
          preferBuiltins: false,
          browser: true,
      }),
      babel(optBabel),
      //buble(),
      postcss({
        extensions: ['.css']
      }),
      minify({ comments: false, }),
    ]
  },
{
    input: 'src/getB64.mjs',
    output: {
      banner: '/*!\n * w-puppeteer-uitest v' + pkg.version + '\n * (c) 2018-2019 ' + pkg.author + '\n * Released under the MIT License.\n */',
      globals: {
        'fs': 'fs',
        'puppeteer': 'puppeteer',
        'bluebird': 'bluebird',
      },
      format: 'umd',
      name: 'w-puppeteer-uitest',
      file: 'dist/w-puppeteer-uitest-getB64.umd.js',
      sourcemap: true
    },
    external: [
        'fs',
        'puppeteer',
        'bluebird',
    ], 
    plugins: [
      commonjs(),
      resolve({
          preferBuiltins: false,
          browser: true,
      }),
      babel(optBabel),
      //buble(),
      postcss({
        extensions: ['.css']
      }),
      minify({ comments: false, }),
    ]
  }
]

